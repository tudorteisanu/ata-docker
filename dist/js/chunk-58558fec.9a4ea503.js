(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-58558fec"],{1681:function(e,t,s){},"1af5":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"px-5"},[e.docsModel.obligatory?[s("div",{staticClass:"text-h6 py-5"},[e._v(" "+e._s(e.$t("orders.form.fields.request_docs"))+" ")]),s("v-row",e._l(e.obligatoryDocuments,(function(t,i){return s("v-col",{key:i,attrs:{cols:"12",xs:"12",sm:"6",md:"6",lg:"4",xl:"4"}},[s("v-card",{staticClass:"active-card-color"},[s("v-card-text",{staticClass:"d-flex"},[s("file-uploader",{attrs:{disabled:e.preview,"error-messages":e.getErrorMessage(t.file_type),label:e.$t("orders.form.fields.docs_short."+t.file_type)+"*",dense:"","truncate-length":"35",rules:[e.rules.required()]},on:{input:e.modifyDocuments},model:{value:t.file,callback:function(s){e.$set(t,"file",s)},expression:"item.file"}}),s("v-tooltip",{attrs:{bottom:"","max-width":"400"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,r=t.attrs;return[s("v-icon",e._g(e._b({staticClass:"ml-2 mb-3"},"v-icon",r,!1),i),[e._v(" mdi-information-outline ")])]}}],null,!0)},[s("span",[e._v(" "+e._s(e.$t("orders.form.fields.docs."+t.file_type))+" ")])])],1),e.showComments?s("comments",{attrs:{top:"-5px",right:"-5",readonly:e.commentsReadonly,field:"documents.file_type/"+t.file_type},on:{update:e.updateComments},model:{value:e.comments["documents.file_type/"+t.file_type],callback:function(s){e.$set(e.comments,"documents.file_type/"+t.file_type,s)},expression:"comments[`documents.file_type/${item.file_type}`]"}}):e._e()],1)],1)})),1)]:e._e(),s("v-row",e._l(e.docsModel.extra[e.area],(function(t,i){return s("v-col",{key:i,attrs:{cols:"12"}},[s("div",{staticClass:"text-h6 py-5"},[e._v(" "+e._s(e.$t("orders.form.fields."+t+"_docs"))+" ")]),s("v-row",[e._l(e.extraDocuments[e.area][t],(function(i,r){return s("v-col",{key:r,attrs:{cols:"12",xs:"12",sm:"6",md:"6",lg:"4",xl:"4"}},[s("v-card",{staticClass:"active-card-color"},[s("v-card-text",{staticStyle:{display:"grid","grid-template-columns":"90% 30px"}},[s("file-uploader",{staticClass:"input",attrs:{disabled:e.preview,rules:0===r?e.extraRules:[],label:e.$t("orders.form.fields.load_file")+""+(0===r&&e.extraRules?"*":""),clearable:!1,dense:"","truncate-length":"30","error-messages":e.getErrorMessage(i.file_type)},on:{input:e.modifyDocuments},model:{value:i.file,callback:function(t){e.$set(i,"file",t)},expression:"item.file"}}),0!==r&&!e.preview||!e.extraRules?s("v-icon",{on:{click:function(s){return e.deleteFile(t,r)}}},[e._v(" mdi-close ")]):e._e()],1),e.showComments?s("comments",{attrs:{top:"-5px",right:"-5",readonly:e.commentsReadonly,field:"documents.file_type/"+i.file_type},on:{update:e.updateComments},model:{value:e.comments["documents.file_type/"+i.file_type],callback:function(t){e.$set(e.comments,"documents.file_type/"+i.file_type,t)},expression:"comments[`documents.file_type/${item.file_type}`]"}}):e._e()],1)],1)})),e.preview?e._e():s("v-col",{attrs:{cols:"12",xs:"12",sm:"6",md:"6",lg:"4",xl:"4"}},[s("v-card",{staticClass:"fill-height full-width",attrs:{elevation:"0"}},[s("v-card-text",{staticClass:"d-flex align-center fill-height pa-0 card-border"},[s("v-btn",{staticClass:"transparent fill-height",attrs:{depressed:"",block:"",height:"80"},on:{click:function(s){return e.addFile(t)}}},[s("v-icon",{staticClass:"font-22",attrs:{color:"primary"}},[e._v(" mdi-plus ")])],1)],1)],1)],1)],2)],1)})),1)],2)},r=[],a=(s("99af"),s("4de4"),s("c740"),s("0481"),s("caad"),s("d81d"),s("a434"),s("4069"),s("b0c0"),s("a9e3"),s("07ac"),s("2532"),s("2ca0"),s("2909")),n=s("5530"),o=(s("96cf"),s("1da1")),c=s("b85c"),l=s("2b0e"),d=s("5acd"),u=s("de5b"),v=s("a1c6"),h=s("8350"),m=l["a"].extend({name:"Documents",components:{Comments:h["a"],FileUploader:d["a"]},props:{orderType:{type:[String,Number],required:!0},area:{type:[String,Number],required:!1},extraRules:{type:Array,required:!1},documents:{type:Array,required:!1},preview:{type:Boolean,required:!1,default:!1},commentsReadonly:{type:Boolean,required:!1,default:!1},showComments:{type:Boolean,required:!1,default:!1},comments:{type:Object,required:!1,default:function(){return{}}},errorMessages:{type:Object,required:!1,default:function(){return{}}}},data:function(){return{rules:u["a"],documentsModel:v,docsModel:{},obligatoryDocuments:[],extraDocuments:{other:{extra:[]},agro:{constatation:[],authority:[]}},extraDocs:[]}},watch:{area:{handler:function(){if(this.area){var e,t=this.documentsModel[this.orderType],s=Object(c["a"])(t.extra[this.area]);try{for(s.s();!(e=s.n()).done;){var i=e.value;this.extraDocuments[this.area][i]=[{file:null,file_type:i}]}}catch(r){s.e(r)}finally{s.f()}}}},orderType:{immediate:!0,deep:!0,handler:function(){this.docsModel=this.documentsModel[this.orderType]}},comments:{deep:!0,handler:function(){this.$forceUpdate()}}},mounted:function(){this.generateFields()},methods:{modifyDocuments:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.extraDocs=Object.values(e.extraDocuments[e.area]).map((function(e){return e.filter((function(e){return e.file&&e.file.name})).map((function(e){return Object(n["a"])(Object(n["a"])({},e),{},{file_type:e.file_type})}))})),e.$emit("update",[].concat(Object(a["a"])(e.obligatoryDocuments),Object(a["a"])(e.extraDocs.flat())));case 2:case"end":return t.stop()}}),t)})))()},addFile:function(e){this.extraDocuments[this.area][e].push({file:null,file_type:"".concat(e,".").concat(this.extraDocuments[this.area][e].length)}),this.$forceUpdate()},deleteFile:function(e,t){this.extraDocuments[this.area][e].splice(t,1),this.$forceUpdate()},generateFields:function(){var e=this,t=this.documentsModel[this.orderType];if(this.setUpExtraDocuments(),!this.documents&&t.obligatory){var s,i=Object(c["a"])(t.obligatory);try{for(i.s();!(s=i.n()).done;){var r=s.value;this.obligatoryDocuments.push({file:null,file_type:r})}}catch(u){i.e(u)}finally{i.f()}}else{var n;if(t.obligatory)this.obligatoryDocuments=Object(a["a"])(null===(n=this.documents)||void 0===n?void 0:n.filter((function(e){return t.obligatory.includes(e.file_type)})));var o,l=Object(c["a"])(t.extra[this.area]);try{var d=function(){var t=o.value;e.extraDocuments[e.area][t]=Object(a["a"])(e.documents.filter((function(e){return e.file_type.startsWith(t)})))};for(l.s();!(o=l.n()).done;)d()}catch(u){l.e(u)}finally{l.f()}}this.$forceUpdate()},setUpExtraDocuments:function(){if(this.area){var e,t=Object(c["a"])(this.docsModel.extra[this.area]);try{for(t.s();!(e=t.n()).done;){var s=e.value;this.extraDocuments[this.area][s]=[]}}catch(i){t.e(i)}finally{t.f()}}},updateComments:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:t.$emit("getComments",e);case 1:case"end":return s.stop()}}),s)})))()},getErrorMessage:function(e){var t=[].concat(Object(a["a"])(this.obligatoryDocuments),Object(a["a"])(this.extraDocs.flat())),s=t.findIndex((function(t){return t.file_type===e}));return-1!==s?this.errorMessages["documents.".concat(s,".file")]:[]}}}),f=m,p=(s("8bdc"),s("2877")),_=s("6544"),g=s.n(_),y=s("8336"),b=s("b0af"),x=s("99d9"),S=s("62ad"),w=s("132d"),C=s("0fd9"),k=s("3a2f"),$=Object(p["a"])(f,i,r,!1,null,"1daa5577",null);t["a"]=$.exports;g()($,{VBtn:y["a"],VCard:b["a"],VCardText:x["c"],VCol:S["a"],VIcon:w["a"],VRow:C["a"],VTooltip:k["a"]})},"1c46":function(e,t,s){},"1f09":function(e,t,s){},"1f4f":function(e,t,s){"use strict";s("a9e3");var i=s("5530"),r=(s("8b37"),s("80d2")),a=s("7560"),n=s("58df");t["a"]=Object(n["a"])(a["a"]).extend({name:"v-simple-table",props:{dense:Boolean,fixedHeader:Boolean,height:[Number,String]},computed:{classes:function(){return Object(i["a"])({"v-data-table--dense":this.dense,"v-data-table--fixed-height":!!this.height&&!this.fixedHeader,"v-data-table--fixed-header":this.fixedHeader,"v-data-table--has-top":!!this.$slots.top,"v-data-table--has-bottom":!!this.$slots.bottom},this.themeClasses)}},methods:{genWrapper:function(){return this.$slots.wrapper||this.$createElement("div",{staticClass:"v-data-table__wrapper",style:{height:Object(r["g"])(this.height)}},[this.$createElement("table",this.$slots.default)])}},render:function(e){return e("div",{staticClass:"v-data-table",class:this.classes},[this.$slots.top,this.genWrapper(),this.$slots.bottom])}})},3129:function(e,t,s){"use strict";s("a630"),s("c975"),s("d81d"),s("ac1f"),s("3ca3"),s("5319"),s("1276");var i=s("3835"),r=s("5530"),a=(s("1f09"),s("c995")),n=s("24b2"),o=s("7560"),c=s("58df"),l=s("80d2");t["a"]=Object(c["a"])(a["a"],n["a"],o["a"]).extend({name:"VSkeletonLoader",props:{boilerplate:Boolean,loading:Boolean,tile:Boolean,transition:String,type:String,types:{type:Object,default:function(){return{}}}},computed:{attrs:function(){return this.isLoading?this.boilerplate?{}:Object(r["a"])({"aria-busy":!0,"aria-live":"polite",role:"alert"},this.$attrs):this.$attrs},classes:function(){return Object(r["a"])(Object(r["a"])({"v-skeleton-loader--boilerplate":this.boilerplate,"v-skeleton-loader--is-loading":this.isLoading,"v-skeleton-loader--tile":this.tile},this.themeClasses),this.elevationClasses)},isLoading:function(){return!("default"in this.$scopedSlots)||this.loading},rootTypes:function(){return Object(r["a"])({actions:"button@2",article:"heading, paragraph",avatar:"avatar",button:"button",card:"image, card-heading","card-avatar":"image, list-item-avatar","card-heading":"heading",chip:"chip","date-picker":"list-item, card-heading, divider, date-picker-options, date-picker-days, actions","date-picker-options":"text, avatar@2","date-picker-days":"avatar@28",heading:"heading",image:"image","list-item":"text","list-item-avatar":"avatar, text","list-item-two-line":"sentences","list-item-avatar-two-line":"avatar, sentences","list-item-three-line":"paragraph","list-item-avatar-three-line":"avatar, paragraph",paragraph:"text@3",sentences:"text@2",table:"table-heading, table-thead, table-tbody, table-tfoot","table-heading":"heading, text","table-thead":"heading@6","table-tbody":"table-row-divider@6","table-row-divider":"table-row, divider","table-row":"table-cell@6","table-cell":"text","table-tfoot":"text@2, avatar@2",text:"text"},this.types)}},methods:{genBone:function(e,t){return this.$createElement("div",{staticClass:"v-skeleton-loader__".concat(e," v-skeleton-loader__bone")},t)},genBones:function(e){var t=this,s=e.split("@"),r=Object(i["a"])(s,2),a=r[0],n=r[1],o=function(){return t.genStructure(a)};return Array.from({length:n}).map(o)},genStructure:function(e){var t=[];e=e||this.type||"";var s=this.rootTypes[e]||"";if(e===s);else{if(e.indexOf(",")>-1)return this.mapBones(e);if(e.indexOf("@")>-1)return this.genBones(e);s.indexOf(",")>-1?t=this.mapBones(s):s.indexOf("@")>-1?t=this.genBones(s):s&&t.push(this.genStructure(s))}return[this.genBone(e,t)]},genSkeleton:function(){var e=[];return this.isLoading?e.push(this.genStructure()):e.push(Object(l["s"])(this)),this.transition?this.$createElement("transition",{props:{name:this.transition},on:{afterEnter:this.resetStyles,beforeEnter:this.onBeforeEnter,beforeLeave:this.onBeforeLeave,leaveCancelled:this.resetStyles}},e):e},mapBones:function(e){return e.replace(/\s/g,"").split(",").map(this.genStructure)},onBeforeEnter:function(e){this.resetStyles(e),this.isLoading&&(e._initialStyle={display:e.style.display,transition:e.style.transition},e.style.setProperty("transition","none","important"))},onBeforeLeave:function(e){e.style.setProperty("display","none","important")},resetStyles:function(e){e._initialStyle&&(e.style.display=e._initialStyle.display||"",e.style.transition=e._initialStyle.transition,delete e._initialStyle)}},render:function(e){return e("div",{staticClass:"v-skeleton-loader",attrs:this.attrs,on:this.$listeners,class:this.classes,style:this.isLoading?this.measurableStyles:void 0},[this.genSkeleton()])}})},"3a60":function(e,t,s){(function(t,s){e.exports=s()})(0,(function(){return function(e){function t(i){if(s[i])return s[i].exports;var r=s[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var s={};return t.m=e,t.c=s,t.i=function(e){return e},t.d=function(e,s,i){t.o(e,s)||Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p=".",t(t.s=10)}([function(e,t){e.exports={"#":{pattern:/\d/},X:{pattern:/[0-9a-zA-Z]/},S:{pattern:/[a-zA-Z]/},A:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleUpperCase()}},a:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleLowerCase()}},"!":{escape:!0}}},function(e,t,s){"use strict";function i(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!0),t}var r=s(2),a=s(0),n=s.n(a);t.a=function(e,t){var a=t.value;if((Array.isArray(a)||"string"==typeof a)&&(a={mask:a,tokens:n.a}),"INPUT"!==e.tagName.toLocaleUpperCase()){var o=e.getElementsByTagName("input");if(1!==o.length)throw new Error("v-mask directive requires 1 input, found "+o.length);e=o[0]}e.oninput=function(t){if(t.isTrusted){var n=e.selectionEnd,o=e.value[n-1];for(e.value=s.i(r.a)(e.value,a.mask,!0,a.tokens);n<e.value.length&&e.value.charAt(n-1)!==o;)n++;e===document.activeElement&&(e.setSelectionRange(n,n),setTimeout((function(){e.setSelectionRange(n,n)}),0)),e.dispatchEvent(i("input"))}};var c=s.i(r.a)(e.value,a.mask,!0,a.tokens);c!==e.value&&(e.value=c,e.dispatchEvent(i("input")))}},function(e,t,s){"use strict";var i=s(6),r=s(5);t.a=function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments[3];return Array.isArray(t)?s.i(r.a)(i.a,t,n)(e,t,a,n):s.i(i.a)(e,t,a,n)}},function(e,t,s){"use strict";function i(e){e.component(c.a.name,c.a),e.directive("mask",n.a)}Object.defineProperty(t,"__esModule",{value:!0});var r=s(0),a=s.n(r),n=s(1),o=s(7),c=s.n(o);s.d(t,"TheMask",(function(){return c.a})),s.d(t,"mask",(function(){return n.a})),s.d(t,"tokens",(function(){return a.a})),s.d(t,"version",(function(){return l}));var l="0.11.1";t.default=i,"undefined"!=typeof window&&window.Vue&&window.Vue.use(i)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(1),r=s(0),a=s.n(r),n=s(2);t.default={name:"TheMask",props:{value:[String,Number],mask:{type:[String,Array],required:!0},masked:{type:Boolean,default:!1},tokens:{type:Object,default:function(){return a.a}}},directives:{mask:i.a},data:function(){return{lastValue:null,display:this.value}},watch:{value:function(e){e!==this.lastValue&&(this.display=e)},masked:function(){this.refresh(this.display)}},computed:{config:function(){return{mask:this.mask,tokens:this.tokens,masked:this.masked}}},methods:{onInput:function(e){e.isTrusted||this.refresh(e.target.value)},refresh:function(e){this.display=e;e=s.i(n.a)(e,this.mask,this.masked,this.tokens);e!==this.lastValue&&(this.lastValue=e,this.$emit("input",e))}}}},function(e,t,s){"use strict";function i(e,t,s){return t=t.sort((function(e,t){return e.length-t.length})),function(i,r){for(var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;n<t.length;){var o=t[n];n++;var c=t[n];if(!(c&&e(i,c,!0,s).length>o.length))return e(i,o,a,s)}return""}}t.a=i},function(e,t,s){"use strict";function i(e,t){var s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments[3];e=e||"",t=t||"";for(var r=0,a=0,n="";r<t.length&&a<e.length;){var o=t[r],c=i[o],l=e[a];c&&!c.escape?(c.pattern.test(l)&&(n+=c.transform?c.transform(l):l,r++),a++):(c&&c.escape&&(r++,o=t[r]),s&&(n+=o),l===o&&a++,r++)}for(var d="";r<t.length&&s;){o=t[r];if(i[o]){d="";break}d+=o,r++}return n+d}t.a=i},function(e,t,s){var i=s(8)(s(4),s(9),null,null);e.exports=i.exports},function(e,t){e.exports=function(e,t,s,i){var r,a=e=e||{},n=typeof e.default;"object"!==n&&"function"!==n||(r=e,a=e.default);var o="function"==typeof a?a.options:a;if(t&&(o.render=t.render,o.staticRenderFns=t.staticRenderFns),s&&(o._scopeId=s),i){var c=o.computed||(o.computed={});Object.keys(i).forEach((function(e){var t=i[e];c[e]=function(){return t}}))}return{esModule:r,exports:a,options:o}}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("input",{directives:[{name:"mask",rawName:"v-mask",value:e.config,expression:"config"}],attrs:{type:"text"},domProps:{value:e.display},on:{input:e.onInput}})},staticRenderFns:[]}},function(e,t,s){e.exports=s(3)}])}))},"53c0":function(e,t,s){},5791:function(e,t,s){"use strict";s("53c0")},"8b37":function(e,t,s){},"8bdc":function(e,t,s){"use strict";s("1c46")},"99fe":function(e,t,s){},"9d01":function(e,t,s){},a565:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-row",{staticClass:"py-2"},[e.loading?s("v-skeleton-loader",{staticStyle:{"max-width":"1400px","min-height":"75vh"},attrs:{width:"100%",type:"card-avatar, article, list-item-three-line, list-item-three-line, actions"}}):[s("v-card",{staticClass:"full-width ma-10"},[e.isSelectBeneficiary?s("v-row",{staticClass:"actions mt-0"},[s("v-col",{staticClass:"pa-2 d-flex align-center"},[s("span",{staticClass:"caption ml-3"},[e._v(" "+e._s(e.$t("global-validation.is_required"))+" ")]),s("v-spacer"),s("v-btn",{attrs:{link:"",to:"/orders",text:""}},[e._v(" "+e._s(e.$t("global-buttons.close"))+" ")]),s("v-btn",{staticClass:"ml-2",attrs:{color:"primary",depressed:"",disabled:e.isLoading},on:{click:e.submit}},[e.isLoading?s("v-progress-circular",{staticStyle:{position:"absolute"},attrs:{indeterminate:"",color:"primary"}}):e._e(),e._v(" "+e._s(e.$t("global-buttons.confirm"))+" ")],1)],1)],1):e._e(),e.isSelectBeneficiary?s("v-tabs",{staticClass:"mb-2",attrs:{"align-with-title":""},model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[s("v-tab",{key:"order"},[s("span",[e._v(e._s(e.$t("orders.tabs.create")))])]),s("v-tab",{key:"services",staticClass:"text-no-wrap",attrs:{disabled:!e.isSelectBeneficiary}},[s("span",[e._v(e._s(e.$t("orders.tabs.services")))]),e.totalSum>0?s("span",[e._v(" "+e._s("("+e.totalSum.toFixed(2)+" MDL)"))]):e._e()])],1):e._e(),s("v-tabs-items",{model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[s("v-tab-item",{key:"order",attrs:{eager:""}},[s("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var i=t.hover;return[s("v-card",{staticClass:"elevation-4 px-4 py-2 position-relative",class:{placeholder:i&&!e.isSelectBeneficiary},attrs:{width:"100%"}},[s("v-card-text",{staticClass:"pa-0"},[s("v-form",{directives:[{name:"handle-unsaved",rawName:"v-handle-unsaved"}],ref:"form",staticClass:"d-flex flex-column justify-center"},[s("v-row",{staticClass:"pt-2 mx-2"},[s("v-col",{attrs:{cols:"6"}},[s("client-data",{attrs:{value:e.model,hover:i,"error-messages":e.errorMessages,"service-id":e.serviceId},on:{setClient:e.setClient,clearClient:function(t){return e.clearClient()},update:e.setPowerOfAttorney}})],1),s("v-col",{attrs:{cols:"6"}},[s("v-row",{staticClass:"py-1"},[s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("v-select",{staticClass:"my-0 pt-1",attrs:{outlined:"",dense:"",disabled:!e.isSelectBeneficiary,items:e.selects.cardTypes,rules:[e.rules.required()],label:e.$t("orders.form.fields.document_type"),"error-messages":e.errorMessages.document_type},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.model.order.document_type,callback:function(t){e.$set(e.model.order,"document_type",t)},expression:"model.order.document_type"}})],1),e.isOriginalDocument?e._e():s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("live-search",{attrs:{outlined:"",dense:"","module-name":"orders",label:e.$t("orders.form.fields.parent_carnet")+"*",rules:[e.rules.required("parent_carnet")],clearable:"","search-function":e.search},on:{input:e.setParentCard},model:{value:e.selectedCard,callback:function(t){e.selectedCard=t},expression:"selectedCard"}})],1),s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("v-select",{staticClass:"my-0 pt-1",attrs:{outlined:"",dense:"",items:e.selects.release_types,disabled:!e.isSelectBeneficiary,label:e.$t("orders.form.fields.release_mode")},model:{value:e.model.order.release_mode,callback:function(t){e.$set(e.model.order,"release_mode",t)},expression:"model.order.release_mode"}})],1),e.isSelectBeneficiary?s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("date-picker",{staticClass:"densed-picker",attrs:{outlined:"",dense:"",disabled:!e.isSelectBeneficiary,label:e.$t("orders.form.fields.document_valid_from")+"*",rules:[e.rules.required()],"error-messages":e.errorMessages.document_valid_from,min:(new Date).toISOString()},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.model.order.document_valid_from,callback:function(t){e.$set(e.model.order,"document_valid_from",t)},expression:"model.order.document_valid_from"}})],1):e._e()],1)],1)],1),s("v-row",{staticClass:"py-1 mx-2"},[s("v-col",{staticClass:"py-1",attrs:{cols:"6"}},[s("v-select",{attrs:{outlined:"",dense:"",items:e.areas,label:e.$t("orders.form.fields.area")+"*",rules:[e.rules.required()],disabled:!e.isSelectBeneficiary,"error-messages":e.errorMessages["details.area"]},model:{value:e.model.details.area,callback:function(t){e.$set(e.model.details,"area",t)},expression:"model.details.area"}})],1),s("v-col",{staticClass:"py-1",attrs:{cols:"6"}},[s("v-select",{attrs:{outlined:"",dense:"",items:e.selects.purpose,label:e.$t("orders.form.fields.reason_id")+"*",rules:[e.rules.required()],disabled:!e.isSelectBeneficiary,"error-messages":e.errorMessages["details.purpose_id"]},on:{input:function(t){return e.setPurposeDescription()}},model:{value:e.model.details.purpose_id,callback:function(t){e.$set(e.model.details,"purpose_id",t)},expression:"model.details.purpose_id"}})],1),s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("v-textarea",{attrs:{outlined:"",dense:"",label:e.$t("orders.form.fields.description_of_the_circumstances")+"*",rules:[e.rules.required()],disabled:!e.isSelectBeneficiary,"error-messages":e.errorMessages["details.reason_description"]},model:{value:e.model.details.purpose_description,callback:function(t){e.$set(e.model.details,"purpose_description",t)},expression:"model.details.purpose_description"}})],1)],1),e.isSelectBeneficiary?s("documents",{attrs:{"error-messages":e.errorMessages,"order-type":e.serviceId,area:e.model.details.area,"extra-rules":[e.rules.required()],value:e.model.documents},on:{update:e.loadDocuments}}):e._e(),e.isSelectBeneficiary?s("v-row",{staticClass:"actions mt-5"},[s("v-col",{staticClass:"pa-2 d-flex align-center"},[s("span",{staticClass:"caption"},[e._v(" "+e._s(e.$t("global-validation.is_required"))+" ")]),s("v-spacer"),s("v-btn",{attrs:{link:"",to:"/orders",text:""}},[e._v(" "+e._s(e.$t("global-buttons.close"))+" ")]),s("v-btn",{staticClass:"ml-2",attrs:{color:"primary",depressed:"",disabled:e.isLoading},on:{click:e.submit}},[e.isLoading?s("v-progress-circular",{staticStyle:{position:"absolute"},attrs:{indeterminate:"",color:"primary"}}):e._e(),e._v(" "+e._s(e.$t("global-buttons.confirm"))+" ")],1)],1)],1):e._e()],1)],1),i&&!e.isSelectBeneficiary?s("div",{staticClass:"d-flex align-center justify-center full-width fill-height  display-1",staticStyle:{position:"absolute",top:"0","z-index":"1"}},[s("v-expand-transition",[s("div",{staticClass:"pa-3",staticStyle:{color:"red"}},[e._v(" "+e._s(e.$t("orders.headers.select_beneficiary"))+" ")])])],1):e._e()],1)]}}])})],1),s("v-tab-item",{key:"services",attrs:{eager:""}},[s("v-card",{attrs:{flat:""}},[s("v-card-text",{staticClass:"full-width"},[s("order-services",{attrs:{"service-type-id":e.serviceId,value:e.model},on:{updateVat:e.updateVat,remove:e.removeService,setService:e.setService}})],1)],1)],1)],1)],1)]],2)},r=[],a=(s("a4d3"),s("e01a"),s("4de4"),s("7db0"),s("c740"),s("d81d"),s("13d5"),s("45fc"),s("a434"),s("a9e3"),s("d3b7"),s("3ca3"),s("ddb0"),s("b85c")),n=s("3835"),o=s("5530"),c=(s("96cf"),s("1da1")),l=s("2b0e"),d=s("cb40"),u=s("0613"),v=s("5607a"),h=s("366c"),m=s("de5b"),f=s("3a60"),p=s("e894"),_=s("1af5"),g=s("a1c6"),y=s("b755"),b=l["a"].extend({name:"AtaCreateOrder",components:{OrderServices:y["a"],ClientData:p["a"],LiveSearch:v["a"],DatePicker:d["a"],Documents:_["a"]},props:{language:{type:String,default:"ru",required:!0},serviceId:{required:!0,type:Number},allocations:{required:!0,type:Object}},directives:{mask:f["mask"]},data:function(){return{rules:m["a"],documentsModel:g,loading:!1,isSelectBeneficiary:!1,selectedCard:null,model:{documents:[],supporting_documents:{acts_of_proof:[],authority:[],other:[]},details:{services:[]},order:{source:"operator",client_delegate:"aaij",document_type:"new",client:{type:""},document_valid_from:(new Date).toISOString().substr(0,10),power_of_attorney:"beneficiary"}},errorMessages:{},selects:{cardTypes:[],purpose:[],packingCategories:[],languages:[],client_types:[],release_types:[],areas:["agro","other"]},lang:u["a"].getters["localization/getCurrent"],selectedTab:0,totalSum:0,createBeneficiaryModal:!1,isLoading:!1,breadcrumb:[{text:"orders.title",disabled:!1,href:"/orders"},{text:"orders.form.header.create",disabled:!0,href:"/orders/edit"}],defaultCountry:null,forceKey:0,powerOfAttorney:null}},watch:{language:{immediate:!0,handler:function(){this.model.order.language=this.language}},"model.documents":{immediate:!0,deep:!0,handler:function(){this.$forceUpdate()}}},computed:{isOriginalDocument:function(){return"new"===this.model.order.document_type},areas:function(){var e=this;return this.selects.areas.map((function(t){return{value:t,text:e.$t("orders.areas.".concat(t),e.model.order.language)}}))},isClassic:function(){return"classic"===this.model.order.power_of_attorney},parentLanguage:function(){return"ro"===this.model.order.language}},mounted:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadData();case 2:case"end":return t.stop()}}),t)})))()},methods:{changeKey:function(){this.forceKey=this.forceKey++},getServices:function(e){this.model.details.services=e},getOrderSum:function(e){this.totalSum=e},changePowerType:function(e){this.model.order.power_of_attorney=e},isJuridicalPerson:function(){var e;return"juridical"===(null===(e=this.model.order)||void 0===e?void 0:e.client.type)},isDefaultCountry:function(e){return this.defaultCountry===e},loadData:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,s={"x-localization":e.language},t.next=5,Promise.all([h["a"].purposeOfUse().getList(e.serviceId,s),h["a"].orders().getOrderReleaseModes(),h["a"].clients().getClientTypes(),h["a"].orders().getCardTypes(e.serviceId),h["a"].orders().getLanguages(),h["a"].branches().getList()]);case 5:return i=t.sent,t.next=8,e.setServerResponse(i);case 8:t.next=14;break;case 10:return t.prev=10,t.t0=t["catch"](1),t.next=14,u["a"].dispatch("alert/showError",t.t0.message);case 14:e.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[1,10]])})))()},submit:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var s,i,r,a,n,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=e.$refs.form,e.isLoading=!0,t.prev=2,!s.validate()){t.next=21;break}return e.model.documents=e.model.documents.filter((function(e){return"confirm_represent_power"!==e.file_type})),e.model.documents.push(e.powerOfAttorney),i=Object(o["a"])({},e.model),i.order.service_type_id=e.serviceId,r=e.allocations,a=r.branch_id,n=r.subdivision_id,c=r.handler_id,i.order.branch_id=a,i.order.subdivision_id=n,i.order.handler_id=c,t.next=14,e.$API.orders().create(i);case 14:return s.removeGuard(),t.next=17,e.$router.push("/orders");case 17:return t.next=19,e.$store.dispatch("alert/showSuccess",e.$t("global-alert.successful_create"));case 19:t.next=24;break;case 21:return e.selectedTab=0,t.next=24,setTimeout((function(){var t=s.inputs.find((function(e){return e.messagesToDisplay.length}));t&&e.$vuetify.goTo(t.$el,{offset:150})}),500);case 24:t.next=36;break;case 26:if(t.prev=26,t.t0=t["catch"](2),s.removeGuard(),!t.t0.hasOwnProperty("errors")){t.next=34;break}return e.errorMessages=t.t0.errors,t.next=33,setTimeout((function(){var t=s.inputs.find((function(e){return e.messagesToDisplay.length}));t&&e.$vuetify.goTo(t.$el,{offset:150})}),500);case 33:setTimeout((function(){e.errorMessages={}}),4e3);case 34:return t.next=36,e.$store.dispatch("alert/showError",t.t0.message||t.t0);case 36:e.isLoading=!1;case 37:case"end":return t.stop()}}),t,null,[[2,26]])})))()},setServerResponse:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function s(){var i,r,a,o,c,l,d;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return i=Object(n["a"])(e,6),r=i[0],a=i[1],o=i[2],c=i[3],l=i[4],d=i[5],t.selects.languages=l.items,t.selects.purpose=r,t.selects.release_types=a.items,t.model.order.release_mode=a.default,t.selects.client_types=o,t.selects.cardTypes=c.items,t.model.order.document_type=c.default,t.selects.branches=d,s.next=11,t.loadSubdivisionsByBranch(t.model.order.branch_id);case 11:case"end":return s.stop()}}),s)})))()},loadSpecialists:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$API.users().getList({filter:{service_type:e.serviceId,branch:e.model.order.branch_id}});case 3:e.selects.specialists=t.sent,1===e.selects.specialists.length&&(s=Object(n["a"])(e.selects.specialists,1),i=s[0],e.model.details.employee_id=i.value),t.next=11;break;case 7:return t.prev=7,t.t0=t["catch"](0),t.next=11,e.$store.dispatch("alert/showError",t.t0.message);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},search:function(e,t){var s=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,s.$API[t]().liveSearch(e);case 3:return i.abrupt("return",i.sent);case 6:return i.prev=6,i.t0=i["catch"](0),i.next=10,s.$store.dispatch("alert/showError");case 10:case"end":return i.stop()}}),i,null,[[0,6]])})))()},searchClient:function(e,t){var s=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,s.$API[t]().liveSearchClient(e);case 3:return i.t0=i.sent,i.abrupt("return",{items:i.t0});case 7:return i.prev=7,i.t1=i["catch"](0),i.next=11,s.$store.dispatch("alert/showError");case 11:case"end":return i.stop()}}),i,null,[[0,7]])})))()},setClient:function(e){this.model.order.client_id=e.id,this.model.order.client=e,this.isSelectBeneficiary=!0},clearClient:function(){this.model.order.client_id=null,delete this.model.order.client,this.isSelectBeneficiary=!1},changeData:function(e){this.model.details.countries=e},setParentCard:function(e){null!==e&&void 0!==e&&e.value&&(this.model.order.parent_document_id=e.value)},updateVat:function(e){this.model.details.services[e].sum_no_vat=Number(this.model.details.services[e].sum_no_vat),this.model.details.services[e].sum_with_vat=this.addVat(Number(this.model.details.services[e].sum_no_vat)),this.model.details.services[e].remained_sum=Number(this.model.details.services[e].sum_with_vat)-Number(this.model.details.services[e].paid_sum),this.getTotalSum()},addVat:function(e){return e+20*e/100},removeService:function(e){var t=this;if(Array.isArray(e)){var s,i=Object(a["a"])(e);try{var r=function(){var e=s.value,i=t.model.details.services.findIndex((function(t){return t.service_id===e}));-1!==i&&t.model.details.services.splice(i,1)};for(i.s();!(s=i.n()).done;)r()}catch(o){i.e(o)}finally{i.f()}}else{var n=this.model.details.services.findIndex((function(t){return t.service_id===e}));-1!==n&&this.model.details.services.splice(n,1)}this.getTotalSum()},setService:function(e){var t,s;if(null!==(t=this.model.details)&&void 0!==t&&null!==(s=t.services)&&void 0!==s&&s.some((function(t){return t.service_id===e.service_id}))){var i=this.model.details.services.findIndex((function(t){return t.service_id===e.service_id}));this.model.details.services[i]=Object(o["a"])(Object(o["a"])({},this.model.details.services[i]),e)}else this.model.details.services.push(e);this.getTotalSum()},getTotalSum:function(){this.totalSum=this.model.details.services.reduce((function(e,t){var s=t.sum_with_vat;return s?e+Number(s):e}),0)},setPurposeDescription:function(){var e=this,t=this.selects.purpose.findIndex((function(t){return t.value===e.model.details.purpose_id}));-1===t||this.model.details.purpose_description||(this.model.details.purpose_description=this.selects.purpose[t].description)},setBeneficiary:function(e){this.setClient(e)},loadDocuments:function(e){this.model.documents=e},loadSubdivisionsByBranch:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.$API.subdivisions().getList({filter:{branch_id:e}});case 3:return t.selects.subdivisions=s.sent,t.selects.subdivisions.some((function(e){return e.value===t.model.order.subdivision_id}))||(t.model.order.subdivision_id=null),s.next=7,t.loadSpecialists();case 7:s.next=13;break;case 9:return s.prev=9,s.t0=s["catch"](0),s.next=13,t.$store.dispatch("alert/showError",s.t0.message);case 13:case"end":return s.stop()}}),s,null,[[0,9]])})))()},setPowerOfAttorney:function(e){this.powerOfAttorney=Object(o["a"])({},e)}}}),x=b,S=(s("5791"),s("2877")),w=s("6544"),C=s.n(w),k=s("8336"),$=s("b0af"),O=s("99d9"),V=s("62ad"),j=s("0789"),E=s("4bd4"),T=s("ce87"),A=s("490a"),D=s("0fd9"),B=s("b974"),R=s("3129"),q=s("2fa4"),I=s("71a3"),M=s("c671"),P=s("fe57"),L=s("aac8"),N=s("a844"),F=Object(S["a"])(x,i,r,!1,null,"21d227fa",null);t["default"]=F.exports;C()(F,{VBtn:k["a"],VCard:$["a"],VCardText:O["c"],VCol:V["a"],VExpandTransition:j["a"],VForm:E["a"],VHover:T["a"],VProgressCircular:A["a"],VRow:D["a"],VSelect:B["a"],VSkeletonLoader:R["a"],VSpacer:q["a"],VTab:I["a"],VTabItem:M["a"],VTabs:P["a"],VTabsItems:L["a"],VTextarea:N["a"]})},a844:function(e,t,s){"use strict";s("a9e3");var i=s("5530"),r=(s("1681"),s("8654")),a=s("58df"),n=Object(a["a"])(r["a"]);t["a"]=n.extend({name:"v-textarea",props:{autoGrow:Boolean,noResize:Boolean,rowHeight:{type:[Number,String],default:24,validator:function(e){return!isNaN(parseFloat(e))}},rows:{type:[Number,String],default:5,validator:function(e){return!isNaN(parseInt(e,10))}}},computed:{classes:function(){return Object(i["a"])({"v-textarea":!0,"v-textarea--auto-grow":this.autoGrow,"v-textarea--no-resize":this.noResizeHandle},r["a"].options.computed.classes.call(this))},noResizeHandle:function(){return this.noResize||this.autoGrow}},watch:{lazyValue:function(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)},rowHeight:function(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)}},mounted:function(){var e=this;setTimeout((function(){e.autoGrow&&e.calculateInputHeight()}),0)},methods:{calculateInputHeight:function(){var e=this.$refs.input;if(e){e.style.height="0";var t=e.scrollHeight,s=parseInt(this.rows,10)*parseFloat(this.rowHeight);e.style.height=Math.max(s,t)+"px"}},genInput:function(){var e=r["a"].options.methods.genInput.call(this);return e.tag="textarea",delete e.data.attrs.type,e.data.attrs.rows=this.rows,e},onInput:function(e){r["a"].options.methods.onInput.call(this,e),this.autoGrow&&this.calculateInputHeight()},onKeyDown:function(e){this.isFocused&&13===e.keyCode&&e.stopPropagation(),this.$emit("keydown",e)}}})},b1e7:function(e,t,s){"use strict";s("99fe")},b65f:function(e,t,s){var i=s("23e7"),r=Math.ceil,a=Math.floor;i({target:"Math",stat:!0},{trunc:function(e){return(e>0?a:r)(e)}})},b73d:function(e,t,s){"use strict";s("0481"),s("4069");var i=s("5530"),r=(s("ec29"),s("9d01"),s("fe09")),a=s("c37a"),n=s("c3f0"),o=s("0789"),c=s("490a"),l=s("80d2");t["a"]=r["a"].extend({name:"v-switch",directives:{Touch:n["a"]},props:{inset:Boolean,loading:{type:[Boolean,String],default:!1},flat:{type:Boolean,default:!1}},computed:{classes:function(){return Object(i["a"])(Object(i["a"])({},a["a"].options.computed.classes.call(this)),{},{"v-input--selection-controls v-input--switch":!0,"v-input--switch--flat":this.flat,"v-input--switch--inset":this.inset})},attrs:function(){return{"aria-checked":String(this.isActive),"aria-disabled":String(this.isDisabled),role:"switch"}},validationState:function(){return this.hasError&&this.shouldValidate?"error":this.hasSuccess?"success":null!==this.hasColor?this.computedColor:void 0},switchData:function(){return this.setTextColor(this.loading?void 0:this.validationState,{class:this.themeClasses})}},methods:{genDefaultSlot:function(){return[this.genSwitch(),this.genLabel()]},genSwitch:function(){return this.$createElement("div",{staticClass:"v-input--selection-controls__input"},[this.genInput("checkbox",Object(i["a"])(Object(i["a"])({},this.attrs),this.attrs$)),this.genRipple(this.setTextColor(this.validationState,{directives:[{name:"touch",value:{left:this.onSwipeLeft,right:this.onSwipeRight}}]})),this.$createElement("div",Object(i["a"])({staticClass:"v-input--switch__track"},this.switchData)),this.$createElement("div",Object(i["a"])({staticClass:"v-input--switch__thumb"},this.switchData),[this.genProgress()])])},genProgress:function(){return this.$createElement(o["c"],{},[!1===this.loading?null:this.$slots.progress||this.$createElement(c["a"],{props:{color:!0===this.loading||""===this.loading?this.color||"primary":this.loading,size:16,width:2,indeterminate:!0}})])},onSwipeLeft:function(){this.isActive&&this.onChange()},onSwipeRight:function(){this.isActive||this.onChange()},onKeydown:function(e){(e.keyCode===l["y"].left&&this.isActive||e.keyCode===l["y"].right&&!this.isActive)&&this.onChange()}}})},b755:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-card",{staticClass:"full-width"},[s("v-card-title",[e._v(e._s(e.$t("orders.services.title"))+" ")]),s("v-card-text",[s("v-simple-table",{staticClass:"full-width"},[s("thead",[s("tr",[s("th",[e._v(e._s(e.$t("orders.services.service")))]),e.isEdit?s("th",[e._v(" "+e._s(e.$t("orders.services.date_created"))+" ")]):e._e(),e.isEdit?e._e():s("th"),s("th",{staticStyle:{width:"5em"}},[e._v(" "+e._s(e.$t("orders.services.units"))+" ")]),s("th",{staticStyle:{width:"11em"}},[e._v(" "+e._s(e.$t("orders.services.sum_no_vat"))+" ")]),s("th",{staticStyle:{width:"11em"}},[e._v(" "+e._s(e.$t("orders.services.sum_with_vat"))+" ")]),e.isEdit?[s("th",{staticStyle:{width:"10em"}},[e._v(" "+e._s(e.$t("orders.services.paid_sum"))+" ")]),s("th",{staticStyle:{width:"13em"}},[e._v(" "+e._s(e.$t("orders.services.remained_sum"))+" ")]),e.isEdit?s("th"):e._e()]:e._e()],2)]),s("tbody",{key:e.forceKey},[e._l(e.model.details.services,(function(t,i){return s("tr",{key:i,class:{"deleted-service":t._isDeleted}},[s("td",{staticStyle:{width:"350px"}},[s("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(i){var r=i.on,a=i.attrs;return[s("span",e._g(e._b({staticClass:"overflow-hidden text-no-wrap"},"span",a,!1),r),[e._v(" "+e._s(t.name)+" ")])]}}],null,!0)},[s("span",[e._v(" "+e._s(t.name)+" ")])])],1),s("td",{staticClass:"text-right text-no-wrap"},[e._v(" "+e._s(t.created_at)+" ")]),s("td",{staticClass:"text-right"},[e._v(e._s(t.quantity))]),s("td",{staticClass:"text-right"},[t.editable?s("v-text-field",{attrs:{type:"number","hide-details":"",dense:""},on:{input:function(t){return e.updateVat(i)}},model:{value:t.sum_no_vat,callback:function(s){e.$set(t,"sum_no_vat",s)},expression:"service.sum_no_vat"}}):s("span",[e._v(" "+e._s(t.sum_no_vat)+" ")])],1),s("td",{staticClass:"text-right"},[s("span",[e._v(" "+e._s(t.sum_with_vat)+" ")])]),e.isEdit?[s("td",{staticClass:"text-right"},[e._v(" "+e._s(t.paid_sum)+" ")]),s("td",{staticClass:"text-right"},[e._v(" "+e._s(t.remained_sum)+" ")]),e.disabled?e._e():s("td",[e.can("delete",t.alias)&&0===t.paid_sum&&!t._isDeleted?s("v-btn",{attrs:{small:"",icon:"",title:e.$t("orders.services.alert.delete")},on:{click:function(s){return e.toggleDeleteService(t)}}},[s("v-icon",{attrs:{color:"error",small:""}},[e._v("mdi-close")])],1):e._e(),t._isDeleted?s("v-btn",{attrs:{small:"",icon:"",title:e.$t("orders.services.alert.undo_delete")},on:{click:function(s){return e.toggleDeleteService(t)}}},[s("v-icon",{attrs:{color:"error",small:""}},[e._v("mdi-undo-variant")])],1):e._e()],1)]:e._e()],2)})),(e.extraVisitsAfter>0||0===e.extraVisitsAfter&&e.isDataChanged)&&this.canAddExtraServices?s("tr",[s("td",{staticClass:"mt-4 font-weight-bold",attrs:{colspan:"4"}},[e._v(" "+e._s(e.$t("orders.form.fields.extra_services"))+" ")]),e.isEdit?s("td",{attrs:{colspan:"4"}}):e._e()]):e._e(),e.extraVisitsAfter>0&&this.canAddExtraServices?s("tr",[s("td",[e._v(" "+e._s(e.services.extra_visits_after&&e.services.extra_visits_after.text)+" ")]),s("td"),s("td",{staticClass:"text-right"},[e._v(e._s(e.extraVisitsAfter))]),s("td",{staticClass:"text-right"},[e._v(" "+e._s(e.extraVisitsAfterSum)+" ")]),s("td",{staticClass:"text-right"},[e._v(" "+e._s(e.addVat(e.extraVisitsAfterSum))+" ")]),e.isEdit?s("td",{attrs:{colspan:"3"}}):e._e()]):e._e(),e.isDataChanged&&0===e.extraVisitsAfter&&this.canAddExtraServices?s("tr",[s("td",[e._v(" "+e._s(e.services.data_edit&&e.services.data_edit.text)+" ")]),e.isEdit?s("td",{staticClass:"text-right"}):e._e(),s("td",{staticClass:"text-right"},[e._v("1")]),s("td",{staticClass:"text-right"},[e._v(" "+e._s(e.dataEditSum)+" ")]),s("td",{staticClass:"text-right"},[e._v(" "+e._s(e.addVat(e.dataEditSum))+" ")]),e.isEdit?s("td",{attrs:{colspan:"3"}}):e._e()]):e._e()],2),s("tfoot",[s("tr",[s("th"),s("th"),s("th",{staticClass:"text-right"},[e._v(" "+e._s(e.$t("orders.services.total"))+" ")]),s("th",{staticClass:"text-right"},[e._v(" "+e._s(e.servicesTotalSum&&e.servicesTotalSum.toFixed(2))+" ")]),s("th",{staticClass:"text-right"},[e._v(" "+e._s(e.servicesVatTotalSum&&e.servicesVatTotalSum.toFixed(2))+" ")]),e.isEdit?[s("th",{staticClass:"text-right"},[e._v(" "+e._s(e.totalPayedServiceSUm&&e.totalPayedServiceSUm.toFixed(2))+" ")]),s("th",{staticClass:"text-right"},[e._v(" "+e._s(e.totalRemainedForPayServiceSUm&&e.totalRemainedForPayServiceSUm.toFixed(2))+" ")])]:e._e()],2)])])],1)],1),e.showGuarantee?s("v-card",{staticClass:"mt-2"},[s("v-card-title",[e._v(e._s(e.$t("orders.services.guarantee")))]),s("v-card-text",[s("v-row",[e.disabled?e._e():s("v-col",{attrs:{cols:"6"}},[s("v-switch",{attrs:{label:e.$t("orders.services.guarantee_required")},on:{change:function(t){return e.setGuaranteePrice()}},model:{value:e.model.details.guaranty_required,callback:function(t){e.$set(e.model.details,"guaranty_required",t)},expression:"model.details.guaranty_required"}}),s("v-switch",{staticStyle:{visibility:"hidden"},attrs:{label:"Ata exposition"},model:{value:e.model.order.for_cci_exposition,callback:function(t){e.$set(e.model.order,"for_cci_exposition",t)},expression:"model.order.for_cci_exposition"}})],1),s("v-col",[s("v-text-field",{attrs:{type:"number",min:"0",label:e.$t("orders.form.fields.required_guaranty_sum"),disabled:!e.model.details.guaranty_required},model:{value:e.model.details.required_guaranty_sum,callback:function(t){e.$set(e.model.details,"required_guaranty_sum",t)},expression:"model.details.required_guaranty_sum"}})],1)],1)],1)],1):e._e(),e.isEdit?s("v-row",{staticClass:"mt-4"},[s("v-col",[s("div",{staticClass:"d-flex"},[s("v-spacer"),s("v-btn",{staticClass:"ml-3",attrs:{outlined:"",color:"primary"},on:{click:function(t){return e.previewReceipt()}}},[s("v-icon",[e._v("mdi-printer")]),s("span",{staticClass:"ml-1"},[e._v(e._s(e.$t("orders.services.buttons.print_invoice")))])],1)],1)])],1):e._e()],1)],1)},r=[],a=(s("7db0"),s("c740"),s("4160"),s("caad"),s("13d5"),s("a434"),s("b65f"),s("a9e3"),s("d3b7"),s("2532"),s("159b"),s("ddb0"),s("5530")),n=s("b85c"),o=(s("96cf"),s("1da1")),c=s("2b0e"),l=s("3557"),d=c["a"].extend({name:"OrderServices",props:{value:{required:!0,default:function(){return{}}},showGuarantee:{type:Boolean,default:!1,required:!1},disabled:{required:!1,type:Boolean,default:!1},oldValue:{required:!1,type:Object,default:function(){return{}}},newServices:{required:!1,default:function(){return{}}},isEdit:{required:!1,default:!1,type:Boolean},extraOutputs:{required:!1,default:!1},serviceTypeId:{required:!1,default:null}},data:function(){return{model:{},goods:[],outputs:null,beneficiary:null,releaseMode:null,ataExpositon:null,oldModel:null,services:{},serviceId:null,orderServices:[],totalRemainedForPayServiceSUm:0,totalPayedServiceSUm:0,servicesVatTotalSum:0,servicesTotalSum:0,forceKey:0}},watch:{value:{immediate:!0,deep:!0,handler:function(){this.model=this.value,this.isEdit?this.serviceId=this.model.order.service_type_id:this.serviceId=this.serviceTypeId,this.beneficiary=this.model.order.client,1===this.serviceId&&(this.goods=this.model.details.goods,this.outputs=this.model.details.outputs,this.releaseMode=this.model.order.release_mode,this.ataExpositon=this.model.order.for_cci_exposition),this.calculateSums()}},oldValue:{immediate:!0,handler:function(){this.oldModel=this.oldValue}},extraVisitsAfter:{immediate:!0,handler:function(){this.extraVisitsAfter>0?this.$emit("extraVisitsAfter",{service_id:this.services.extra_visits_after.value,sum_no_vat:this.extraVisitsAfterSum,sum_with_vat:this.addVat(this.extraVisitsAfterSum),quantity:this.extraVisitsAfter}):this.$emit("extraVisitsAfter",null)}},isDataChanged:{immediate:!0,handler:function(){var e,t;this.isDataChanged&&0===this.extraVisitsAfter?this.$emit("dataEdit",{service_id:null===(e=this.services)||void 0===e||null===(t=e.data_edit)||void 0===t?void 0:t.value,sum_no_vat:this.dataEditSum,sum_with_vat:this.addVat(this.dataEditSum),quantity:1}):this.$emit("dataEdit",null)}},additionalSum:{immediate:!0,handler:function(){this.$emit("additionalSumChange",this.additionalSum)}},goods:{immediate:!0,deep:!0,handler:function(){this.goods&&this.goods.length&&this.setGoodsService()}},outputs:{immediate:!0,deep:!0,handler:function(){this.outputs&&this.setOutputsService()}},beneficiary:{immediate:!0,deep:!0,handler:function(){this.beneficiary&&this.setBeneficiaryService()}},releaseMode:{immediate:!0,handler:function(){this.releaseMode&&this.setReleaseModeService()}},ataExpositon:{immediate:!0,handler:function(){this.setCciExpositionService()}}},computed:{extraVisitsAfter:function(){return Number(this.extraOutputs)},dataEditSum:function(){return this.isDataChanged&&0===this.extraVisitsAfter?this.getServicePrice(this.services.data_edit):0},additionalSum:function(){return this.extraVisitsAfterSum+this.dataEditSum},isDataChanged:function(){return JSON.stringify(this.model)!==this.oldModel},canAddExtraServices:function(){var e,t,s;return"issued"===(null===(e=this.model)||void 0===e||null===(t=e.order)||void 0===t||null===(s=t.status)||void 0===s?void 0:s.alias)},goodsSum:function(){var e;return null===(e=this.model.details.goods)||void 0===e?void 0:e.reduce((function(e,t){var s=t.quantity,i=t.price;return s&&i?e+i*s:e}),0)}},mounted:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getServices();case 2:case"end":return t.stop()}}),t)})))()},methods:{getServices:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var s,i,r,a,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$API.services().getListByServiceType(e.serviceId);case 3:r=t.sent,a=Object(n["a"])(r);try{for(a.s();!(o=a.n()).done;)c=o.value,e.services[c.alias]=c}catch(l){a.e(l)}finally{a.f()}null===(s=e.model.details)||void 0===s||null===(i=s.services)||void 0===i||i.forEach((function(t){return t.editable=e.services[t.alias].editable})),t.next=13;break;case 9:return t.prev=9,t.t0=t["catch"](0),t.next=13,e.$store.dispatch("alert/showError",t.t0.message||t.t0);case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))()},setGoodsService:function(){var e="extra_positions";if(this.model.details.goods.length>1){var t=this.getServicePrice(this.services[e],this.goods.length,1);if(this.services.extra_positions){var s={service_id:this.services[e].value,sum_no_vat:t,sum_with_vat:this.addVat(t),quantity:this.goods.length-1,name:this.services[e].text};this.checkService(e,s)}}else this.removeService(e)},setBeneficiaryService:function(){if(this.beneficiary)if(1===this.serviceId){var e="".concat(this.beneficiary.type,"_normal");this.removeService("_normal",!0);var t=this.getServicePrice(this.services[e]),s=t;if("physical"!==this.beneficiary.type&&(s=this.addVat(t)),this.services[e]){var i={service_id:this.services[e].value,sum_no_vat:t,sum_with_vat:s,quantity:1,name:this.services[e].text};this.checkService(e,i),this.setReleaseModeService()}}else 2===this.serviceId&&this.setAAIJService();else this.removeService("_normal",!0)},setReleaseModeService:function(){if(this.services&&"urgent"===this.releaseMode){var e,t;this.$emit("remove",[null===(e=this.services.juridical_urgent)||void 0===e?void 0:e.value,null===(t=this.services.physical_urgent)||void 0===t?void 0:t.value]);var s="".concat(this.beneficiary.type,"_urgent"),i=this.getServicePrice(this.services[s]),r=i;if("physical"!==this.beneficiary.type&&(r=this.addVat(i)),this.services[s]){var a={service_id:this.services[s].value,sum_no_vat:i,sum_with_vat:r,quantity:1,name:this.services[s].text};this.checkService(s,a)}}else if(this.services){var n,o;this.$emit("remove",[null===(n=this.services.juridical_urgent)||void 0===n?void 0:n.value,null===(o=this.services.physical_urgent)||void 0===o?void 0:o.value])}},setOutputsService:function(){var e="extra_visit";if(this.outputs>1){var t=this.getServicePrice(this.services[e],this.outputs-1);if(this.services[e]){var s={service_id:this.services[e].value,sum_no_vat:t,sum_with_vat:this.addVat(t),quantity:this.outputs-1,name:this.services[e].text};this.checkService(e,s)}}else this.removeService(e)},setCciExpositionService:function(){var e="ata_exposition_discount";if(this.ataExpositon){var t=this.getServicePrice(this.services["".concat(this.beneficiary.type,"_normal")]),s=-(t-t*(100-this.getServicePrice(this.services.ata_exposition_discount))/100);if(this.services[e]){var i={service_id:this.services[e].value,sum_no_vat:s,sum_with_vat:s,quantity:1,name:this.services[e].text};this.checkService(e,i)}else{var r;this.$emit("remove",null===(r=this.services[e])||void 0===r?void 0:r.value)}}else this.removeService(e)},checkService:function(e,t){this.$emit("setService",Object(a["a"])(Object(a["a"])({},t),{},{editable:this.services[e].editable}))},setAAIJService:function(){if(2===this.serviceId){var e="aaij",t=this.getServicePrice(this.services.aaij);if(this.services[e]){var s={service_id:this.services[e].value,sum_no_vat:t,sum_with_vat:this.addVat(t),quantity:1,name:this.services[e].text};this.checkService(e,s)}}},removeService:function(e){var t,s,i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r?this.$emit("remove",[null===(t=this.services.juridical_normal)||void 0===t?void 0:t.value,null===(s=this.services.physical_normal)||void 0===s?void 0:s.value]):this.$emit("remove",null===(i=this.services[e])||void 0===i?void 0:i.value)},addVat:function(e){return e+20*e/100},setGuaranteePrice:function(){this.model.details.guaranty_required&&(this.model.details.required_guaranty_sum=Math.trunc(.3*this.goodsSum)||0)},getServicePrice:function(e){var t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e&&e.values?Number(null===(t=e.values.find((function(e){return s>=e.min&&s<=e.max})))||void 0===t?void 0:t.value)*(s-i):0},previewReceipt:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$API.invoices().getFileForPrint(e.model.order.id);case 3:s=t.sent,s&&s.url&&e.downloadFile(s),t.next=11;break;case 7:return t.prev=7,t.t0=t["catch"](0),t.next=11,e.$store.dispatch("alert/showError",t.t0.message);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},toggleDeleteService:function(e){e._isDeleted=!e._isDeleted,"ata_exposition_discount"===e.alias&&(this.model.order.for_cci_exposition=!e._isDeleted),this.$forceUpdate()},can:function(e,t){return l.actions.includes(e)&&!l.subject.includes(t)},downloadFile:function(e){var t=document.createElement("a");t.setAttribute("href",e.url),t.setAttribute("target","_blank"),t.click()},changeReleaseService:function(){var e=this,t=this.services["".concat(this.beneficiary.type,"_urgent")];if(t&&"urgent"===this.release_mode)this.model.details.services.push({name:t.text,service_id:t.value,sum_no_vat:this.getServicePrice(t),sum_with_vat:this.addVat(this.getServicePrice(t)),quantity:1});else if(t&&"normal"===this.release_mode){var s,i=this.model.details.services.findIndex((function(t){return t.alias==="".concat(e.beneficiary.type,"_urgent")}));if(-1!==i)null===(s=this.model.details.services)||void 0===s||s.splice(i,1)}this.forceKey++},updateVat:function(e){this.$emit("updateVat",e),this.calculateSums()},calculateSums:function(){var e,t;if(null!==(e=this.model)&&void 0!==e&&null!==(t=e.details)&&void 0!==t&&t.services){var s=this.model.details.services;this.servicesTotalSum=null===s||void 0===s?void 0:s.reduce((function(e,t){var s=t.sum_no_vat;return s?e+Number(s):e}),0),this.servicesVatTotalSum=null===s||void 0===s?void 0:s.reduce((function(e,t){var s=t.sum_with_vat;return s?e+Number(s):e}),0),this.totalPayedServiceSUm=null===s||void 0===s?void 0:s.reduce((function(e,t){var s=t.paid_sum;return s?e+Number(s):e}),0),this.totalRemainedForPayServiceSUm=null===s||void 0===s?void 0:s.reduce((function(e,t){var s=t.remained_sum;return s?e+Number(s):e}),0),this.$emit("input",this.model.details.services.reduce((function(e,t){var s=t.sum_with_vat;return s?e+Number(s):e}),0))}}}}),u=d,v=(s("b1e7"),s("2877")),h=s("6544"),m=s.n(h),f=s("8336"),p=s("b0af"),_=s("99d9"),g=s("62ad"),y=s("132d"),b=s("0fd9"),x=s("1f4f"),S=s("2fa4"),w=s("b73d"),C=s("8654"),k=s("3a2f"),$=Object(v["a"])(u,i,r,!1,null,"c6343c56",null);t["a"]=$.exports;m()($,{VBtn:f["a"],VCard:p["a"],VCardText:_["c"],VCardTitle:_["d"],VCol:g["a"],VIcon:y["a"],VRow:b["a"],VSimpleTable:x["a"],VSpacer:S["a"],VSwitch:w["a"],VTextField:C["a"],VTooltip:k["a"]})},ce87:function(e,t,s){"use strict";var i=s("16b7"),r=s("f2e7"),a=s("58df"),n=s("d9bd");t["a"]=Object(a["a"])(i["a"],r["a"]).extend({name:"v-hover",props:{disabled:{type:Boolean,default:!1},value:{type:Boolean,default:void 0}},methods:{onMouseEnter:function(){this.runDelay("open")},onMouseLeave:function(){this.runDelay("close")}},render:function(){return this.$scopedSlots.default||void 0!==this.value?(this.$scopedSlots.default&&(e=this.$scopedSlots.default({hover:this.isActive})),Array.isArray(e)&&1===e.length&&(e=e[0]),e&&!Array.isArray(e)&&e.tag?(this.disabled||(e.data=e.data||{},this._g(e.data,{mouseenter:this.onMouseEnter,mouseleave:this.onMouseLeave})),e):(Object(n["c"])("v-hover should only contain a single element",this),e)):(Object(n["c"])("v-hover is missing a default scopedSlot or bound value",this),null);var e}})}}]);
//# sourceMappingURL=chunk-58558fec.9a4ea503.js.map