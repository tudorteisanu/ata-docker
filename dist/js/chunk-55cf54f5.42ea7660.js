(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-55cf54f5"],{"0f8b":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"mt-5 mx-0"},[e._l(e.goods,(function(t,i){return s("v-card",{key:i,staticClass:"pt-3 pb-1 mb-2 item-card"},[s("v-row",{staticClass:"py-0 mb-2 ma-0 mx-2 relative"},[s("v-col",{staticClass:"py-0 d-flex",attrs:{cols:e.$vuetify.breakpoint.smAndDown?12:""}},[s("span",{staticClass:"mr-2 pt-4"},[e._v(e._s(i+1+". ")+" ")]),e.disabled?s("v-text-field",{attrs:{dense:e.dense,outlined:e.outlined,disabled:e.disabled},model:{value:t.name,callback:function(s){e.$set(t,"name",s)},expression:"item.name"}}):s("live-search",{attrs:{dense:e.dense,outlined:e.outlined,disabled:e.disabled,"module-name":"goods",clearable:"",label:e.$t("orders.form.fields.no")+" "+e.$t("orders.form.fields.name")+"*",rules:[e.rules.required("name",!0,!0)],"search-function":e.search,errorMessage:e.errorMessages["goods.details."+i+".name"]},on:{input:function(s){return e.setGoodId(t,i)}},model:{value:e.selectedProduct[i],callback:function(t){e.$set(e.selectedProduct,i,t)},expression:"selectedProduct[index]"}}),e.showComments?s("comments",{attrs:{top:"10px",right:"10",field:"goods."+i+".name"},on:{update:e.updateComments},model:{value:e.comments["goods."+i+".name"],callback:function(t){e.$set(e.comments,"goods."+i+".name",t)},expression:"comments[`goods.${index}.name`]"}}):e._e(),e.parentLanguage||e.$vuetify.breakpoint.smAndDown?s("div",{staticClass:"pa-0"},[e.disabled?e._e():[e.goods.length>1?s("v-btn",{staticClass:"ml-5",attrs:{icon:""}},[s("v-icon",{attrs:{color:"error"},on:{click:function(t){return e.deleteRow(i)}}},[e._v("mdi-close")])],1):e._e()]],2):e._e()],1),e.parentLanguage?e._e():s("v-col",{staticClass:"py-0 d-flex",attrs:{cols:e.$vuetify.breakpoint.smAndDown?12:6}},[s("v-text-field",{attrs:{dense:e.dense,outlined:e.outlined,disabled:e.disabled,label:e.$t("orders.form.fields.name")+" RO*",rules:[e.rules.required(""),e.rules.min(2),e.rules.max(100)],errorMessages:e.errorMessages["goods.details."+i+".name_ro"]},model:{value:t.name_ro,callback:function(s){e.$set(t,"name_ro",s)},expression:"item.name_ro"}}),e.showComments?s("comments",{attrs:{top:"10px",right:"10",field:"goods."+i+".name_ro"},on:{update:e.updateComments},model:{value:e.comments["goods."+i+".name_ro"],callback:function(t){e.$set(e.comments,"goods."+i+".name_ro",t)},expression:"comments[`goods.${index}.name_ro`]"}}):e._e(),e.disabled||e.$vuetify.breakpoint.smAndDown?e._e():[e.goods.length>1?s("v-btn",{staticClass:"ml-5",attrs:{icon:""}},[s("v-icon",{attrs:{color:"error"},on:{click:function(t){return e.deleteRow(i)}}},[e._v("mdi-close")])],1):e._e()]],2)],1),s("v-row",{staticClass:"py-0 mb-2 ma-0 mx-2 relative"},[s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"}},[s("v-text-field",{attrs:{dense:e.dense,outlined:e.outlined,disabled:e.disabled,rules:[e.rules.required("quantity"),e.rules.minNumber(.1),e.rules.maxNumber(99999)],type:"number",min:"0",label:e.$t("orders.form.fields.quantity")+"*",errorMessages:e.errorMessages["goods.details."+i+".quantity"]},model:{value:t.quantity,callback:function(s){e.$set(t,"quantity",s)},expression:"item.quantity"}}),e.showComments?s("comments",{attrs:{top:"10px",right:"10",field:"goods."+i+".quantity"},on:{update:e.updateComments},model:{value:e.comments["goods."+i+".quantity"],callback:function(t){e.$set(e.comments,"goods."+i+".quantity",t)},expression:"comments[`goods.${index}.quantity`]"}}):e._e()],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"}},[s("v-text-field",{attrs:{disabled:e.disabled,dense:e.dense,outlined:e.outlined,rules:[e.rules.required(""),e.rules.minNumber(.1),e.rules.maxNumber(99999)],type:"number",min:"0",label:e.$t("orders.form.fields.size")+"*",errorMessages:e.errorMessages["goods.details."+i+".size"]},model:{value:t.size,callback:function(s){e.$set(t,"size",s)},expression:"item.size"}}),e.showComments?s("comments",{attrs:{top:"10px",right:"10",field:"goods."+i+".size"},on:{update:e.updateComments},model:{value:e.comments["goods."+i+".size"],callback:function(t){e.$set(e.comments,"goods."+i+".size",t)},expression:"comments[`goods.${index}.size`]"}}):e._e()],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"}},[s("v-text-field",{attrs:{disabled:e.disabled,dense:e.dense,outlined:e.outlined,rules:[e.rules.required(""),e.rules.minNumber(.1),e.rules.maxNumber(9e8)],type:"number",min:"0",label:e.$t("orders.form.fields.price")+"*",errorMessages:e.errorMessages["goods.details."+i+".price"]},on:{input:function(s){return e.setPrice(t)},blur:function(s){return e.setDecimals(t)}},model:{value:t.price,callback:function(s){e.$set(t,"price",s)},expression:"item.price"}}),e.showComments?s("comments",{attrs:{top:"10px",right:"10",field:"goods."+i+".price"},on:{update:e.updateComments},model:{value:e.comments["goods."+i+".price"],callback:function(t){e.$set(e.comments,"goods."+i+".price",t)},expression:"comments[`goods.${index}.price`]"}}):e._e()],1),e.currency.text&&e.currency.text!==e.defaultCurrency?s("v-col",{staticClass:"py-0",staticStyle:{position:"relative"},attrs:{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"}},[s("v-text-field",{attrs:{dense:e.dense,outlined:e.outlined,disabled:e.disabled,rules:[e.rules.required("price_currency"),e.rules.minNumber(.1),e.rules.maxNumber(9e8)],type:"number",min:"0",label:e.$t("orders.form.fields.price_currency")+" "+e.currency.text+" *",errorMessages:e.errorMessages["goods.details."+i+".price_currency"]},on:{input:function(s){return e.setPriceCurrency(t)},blur:function(s){return e.setDecimals(t)}},model:{value:t.price_currency,callback:function(s){e.$set(t,"price_currency",s)},expression:"item.price_currency"}}),e.showComments?s("comments",{attrs:{top:"10px",right:"10",field:"goods."+i+".price_currency"},on:{update:e.updateComments},model:{value:e.comments["goods."+i+".price_currency"],callback:function(t){e.$set(e.comments,"goods."+i+".price_currency",t)},expression:"comments[`goods.${index}.price_currency`]"}}):e._e()],1):e._e(),s("v-col",{staticClass:"py-0 d-flex justify-space-between"},[e.disabled?s("v-text-field",{attrs:{dense:e.dense,outlined:e.outlined,disabled:e.disabled},model:{value:t.origin_country_name,callback:function(s){e.$set(t,"origin_country_name",s)},expression:"item.origin_country_name"}}):s("live-search",{attrs:{dense:e.dense,outlined:e.outlined,disabled:e.disabled,"module-name":"countries",rules:[e.rules.required("country",!0)],clearable:"",label:e.$t("orders.form.fields.country_origin")+"*","search-function":e.searchCountry,errorMessage:e.errorMessages["goods.details."+i+".origin_country_id"]},on:{input:function(s){return e.setCountryId(t,i)}},scopedSlots:e._u([{key:"item",fn:function(t){var i=t.item;return[s("v-list-item-content",[s("v-list-item-title",[e._v(" "+e._s(i.label+" - "+i.text)+" ")])],1)]}}],null,!0),model:{value:e.selectedCountry[i],callback:function(t){e.$set(e.selectedCountry,i,t)},expression:"selectedCountry[index]"}}),e.showComments?s("comments",{attrs:{top:"10px",right:"10",field:"goods."+i+".origin_country_id"},on:{update:e.updateComments},model:{value:e.comments["goods."+i+".origin_country_id"],callback:function(t){e.$set(e.comments,"goods."+i+".origin_country_id",t)},expression:"comments[`goods.${index}.origin_country_id`]"}}):e._e()],1)],1)],1)})),s("v-row",{staticClass:"py-0 mx-2"},[s("v-col",{staticClass:"d-flex align-center py-1"},[s("v-btn",{attrs:{text:"",disabled:e.disabled},on:{click:function(t){return e.addRow()}}},[s("v-icon",{attrs:{color:"success"}},[e._v("mdi-plus")]),s("span",{staticClass:"ml-2 caption"},[e._v(e._s(e.$t("orders.buttons.add_goods")))])],1),s("span",{staticClass:"full-width text-right font-weight-bold"},[e._v(" "+e._s(e.$t("orders.form.fields.total"))+" ")])],1),e.goods.length?[e.parentLanguage?e._e():s("v-col",{staticClass:" py-1",attrs:{cols:"2"}}),s("v-col",{staticClass:"text-right pl-4 py-1",attrs:{cols:"1"}},[s("span",[e._v(e._s(e.totalQuantity.toFixed(2)))])]),s("v-col",{staticClass:"text-right pl-4 py-1",attrs:{cols:"1"}},[s("span",[e._v(e._s(e.totalSize.toFixed(2)))])]),s("v-col",{staticClass:"text-right pl-4 py-1",attrs:{cols:"1"}},[s("span",[e._v(e._s(e.orderPrice.toFixed(2)))])]),e.currency.text&&"MDL"!==e.currency.text?s("v-col",{staticClass:"text-right pl-4 py-1",attrs:{cols:"12",sm:"1",md:"1",lg:"1",xl:"1"}},[s("span",[e._v(e._s(e.totalPriceCurrency.toFixed(2)))])]):e._e(),s("v-col",{staticClass:" py-1",attrs:{cols:"2"}})]:e._e()],2)],2)},r=[],a=(s("13d5"),s("a434"),s("b0c0"),s("a9e3"),s("b680"),s("96cf"),s("1da1")),n=s("b85c"),o=s("2b0e"),l=s("5607a"),c=s("de5b"),d=s("8350"),u=o["a"].extend({name:"ProductsPicker",components:{Comments:d["a"],LiveSearch:l["a"]},props:{value:{type:Object,required:!0,default:function(){return[]}},comments:{type:Object,required:!1,default:function(){return{}}},disabled:{required:!1,type:Boolean,default:!1},showComments:{required:!1,type:Boolean,default:!1},outlined:{required:!1,type:Boolean,default:!1},dense:{required:!1,type:Boolean,default:!1},isEdit:{required:!1,type:Boolean,default:!1},currency:{required:!0,type:Object},serviceId:{required:!0,type:Number},errorMessages:{required:!1,default:function(){return{}}}},data:function(){return{rules:c["a"],forceKey:0,selectedCountry:[{value:null,text:""}],selectedProduct:[{value:null,text:""}],defaultCurrency:"MDL",goods:[],firstLoad:!1,item:{price:""},exchangeRate:1,totalPriceCurrency:0,totalPrice:0,orderPrice:0}},watch:{currency:{immediate:!0,handler:function(){var e,t=Object(n["a"])(this.goods);try{for(t.s();!(e=t.n()).done;){var s=e.value;this.setPrice(s)}}catch(i){t.e(i)}finally{t.f()}}},"value.details.exchange_rate":function(){this.exchangeRate=this.value.order.exchange_rate;var e,t=Object(n["a"])(this.goods);try{for(t.s();!(e=t.n()).done;){var s=e.value;this.setPrice(s)}}catch(i){t.e(i)}finally{t.f()}},value:{immediate:!0,deep:!0,handler:function(){this.exchangeRate=this.value.details.exchange_rate,this.goods=this.value.details.goods,this.firstLoad||this.setLiveSearchValues()}},goods:{immediate:!0,deep:!0,handler:function(){this.getPrices()}}},computed:{totalQuantity:function(){return this.goods.reduce((function(e,t){var s=t.quantity;return s?Math.floor(100*(e+Number(s)))/100:Math.floor(100*e)/100}),0)},totalSize:function(){return this.goods.reduce((function(e,t){var s=t.size;return s?Math.floor(100*(e+Number(s)))/100:Math.floor(100*e)/100}),0)},parentLanguage:function(){return"ro"===this.value.order.language}},mounted:function(){this.isEdit||this.goods.length||this.addRow()},methods:{getPrices:function(){this.totalPriceCurrency=this.goods.reduce((function(e,t){var s=t.price_currency,i=t.quantity;return s?Math.floor(100*(e+Number(s)*Number(i)))/100:Math.floor(100*e)/100}),0),this.totalPrice=this.goods.reduce((function(e,t){var s=t.price;return s?Math.floor(100*(e+Number(s)))/100:Math.floor(100*e)/100}),0),this.orderPrice=this.goods.reduce((function(e,t){var s=t.quantity,i=t.price;return s&&i?Math.floor(100*(e+Number(s)*Number(i)))/100:Math.floor(100*e)/100}),0),this.$forceUpdate()},search:function(e,t){var s=this;return Object(a["a"])(regeneratorRuntime.mark((function i(){var r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(i.prev=0,s.disabled){i.next=6;break}return i.next=4,s.$API[t]().liveSearch({searchValue:e,service_type_id:s.serviceId},{"x-localization":s.value.order.language});case 4:return r=i.sent,i.abrupt("return",{items:r});case 6:i.next=12;break;case 8:return i.prev=8,i.t0=i["catch"](0),i.next=12,s.$store.dispatch("alert/showError",i.t0.message||i.t0);case 12:case"end":return i.stop()}}),i,null,[[0,8]])})))()},searchCountry:function(e,t){var s=this;return Object(a["a"])(regeneratorRuntime.mark((function i(){var r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(i.prev=0,s.disabled){i.next=6;break}return r={fields:{value:"id",text:"name",label:"code"},route:"v1.countries.index.get",filter:{name:e,code:e}},i.next=5,s.$API[t]().liveSearch(r);case 5:return i.abrupt("return",i.sent);case 6:i.next=12;break;case 8:return i.prev=8,i.t0=i["catch"](0),i.next=12,s.$store.dispatch("alert/showError",i.t0.message||i.t0);case 12:case"end":return i.stop()}}),i,null,[[0,8]])})))()},addRow:function(){var e=this.goods.length;this.selectedCountry[e]={text:""},this.selectedProduct[e]={text:""},this.goods.push({})},deleteRow:function(e){this.goods.splice(e,1)},changeData:function(){this.$emit("input",this.goods)},setCountryId:function(e,t){e.origin_country_id=this.selectedCountry[t].value},setGoodId:function(e,t){var s;null!==(s=this.selectedProduct[t])&&void 0!==s&&s.value?(e.good_id=this.selectedProduct[t].value,e.name=this.selectedProduct[t].text):e.name=this.selectedProduct[t]},setPriceCurrency:function(e){e.price=Math.ceil(e.price_currency*this.exchangeRate*1e3)/1e3,this.getPrices()},setPrice:function(e){e.price_currency=Math.ceil(e.price/this.exchangeRate*1e3)/1e3,this.getPrices()},setDecimals:function(e){e.price_currency=Number(e.price_currency).toFixed(2),e.price=Number(e.price).toFixed(2)},setLiveSearchValues:function(){if(this.isEdit)for(var e in this.goods)this.selectedProduct[e]={value:this.goods[e].good_id,text:this.goods[e].name},this.selectedCountry[e]={value:this.goods[e].origin_country_id,text:this.goods[e].origin_country_name},this.firstLoad=!0},changeKey:function(){this.forceKey=this.forceKey++},updateComments:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:e.text?t.comments[e.key]=e:delete t.comments[e.key],t.changeKey();case 2:case"end":return s.stop()}}),s)})))()}}}),m=u,v=(s("dee1"),s("2877")),h=s("6544"),f=s.n(h),p=s("8336"),_=s("b0af"),g=s("62ad"),y=s("132d"),b=s("5d23"),x=s("0fd9"),C=s("8654"),w=Object(v["a"])(m,i,r,!1,null,"af941e5c",null);t["a"]=w.exports;f()(w,{VBtn:p["a"],VCard:_["a"],VCol:g["a"],VIcon:y["a"],VListItemContent:b["a"],VListItemTitle:b["c"],VRow:x["a"],VTextField:C["a"]})},"1af5":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"px-5"},[e.docsModel.obligatory?[s("div",{staticClass:"text-h6 py-5"},[e._v(" "+e._s(e.$t("orders.form.fields.request_docs"))+" ")]),s("v-row",e._l(e.obligatoryDocuments,(function(t,i){return s("v-col",{key:i,attrs:{cols:"12",xs:"12",sm:"6",md:"6",lg:"4",xl:"4"}},[s("v-card",{staticClass:"active-card-color"},[s("v-card-text",{staticClass:"d-flex"},[s("file-uploader",{attrs:{disabled:e.preview,"error-messages":e.getErrorMessage(t.file_type),label:e.$t("orders.form.fields.docs_short."+t.file_type)+"*",dense:"","truncate-length":"35",rules:[e.rules.required()]},on:{input:e.modifyDocuments},model:{value:t.file,callback:function(s){e.$set(t,"file",s)},expression:"item.file"}}),s("v-tooltip",{attrs:{bottom:"","max-width":"400"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,r=t.attrs;return[s("v-icon",e._g(e._b({staticClass:"ml-2 mb-3"},"v-icon",r,!1),i),[e._v(" mdi-information-outline ")])]}}],null,!0)},[s("span",[e._v(" "+e._s(e.$t("orders.form.fields.docs."+t.file_type))+" ")])])],1),e.showComments?s("comments",{attrs:{top:"-5px",right:"-5",readonly:e.commentsReadonly,field:"documents.file_type/"+t.file_type},on:{update:e.updateComments},model:{value:e.comments["documents.file_type/"+t.file_type],callback:function(s){e.$set(e.comments,"documents.file_type/"+t.file_type,s)},expression:"comments[`documents.file_type/${item.file_type}`]"}}):e._e()],1)],1)})),1)]:e._e(),s("v-row",e._l(e.docsModel.extra[e.area],(function(t,i){return s("v-col",{key:i,attrs:{cols:"12"}},[s("div",{staticClass:"text-h6 py-5"},[e._v(" "+e._s(e.$t("orders.form.fields."+t+"_docs"))+" ")]),s("v-row",[e._l(e.extraDocuments[e.area][t],(function(i,r){return s("v-col",{key:r,attrs:{cols:"12",xs:"12",sm:"6",md:"6",lg:"4",xl:"4"}},[s("v-card",{staticClass:"active-card-color"},[s("v-card-text",{staticStyle:{display:"grid","grid-template-columns":"90% 30px"}},[s("file-uploader",{staticClass:"input",attrs:{disabled:e.preview,rules:0===r?e.extraRules:[],label:e.$t("orders.form.fields.load_file")+""+(0===r&&e.extraRules?"*":""),clearable:!1,dense:"","truncate-length":"30","error-messages":e.getErrorMessage(i.file_type)},on:{input:e.modifyDocuments},model:{value:i.file,callback:function(t){e.$set(i,"file",t)},expression:"item.file"}}),0!==r&&!e.preview||!e.extraRules?s("v-icon",{on:{click:function(s){return e.deleteFile(t,r)}}},[e._v(" mdi-close ")]):e._e()],1),e.showComments?s("comments",{attrs:{top:"-5px",right:"-5",readonly:e.commentsReadonly,field:"documents.file_type/"+i.file_type},on:{update:e.updateComments},model:{value:e.comments["documents.file_type/"+i.file_type],callback:function(t){e.$set(e.comments,"documents.file_type/"+i.file_type,t)},expression:"comments[`documents.file_type/${item.file_type}`]"}}):e._e()],1)],1)})),e.preview?e._e():s("v-col",{attrs:{cols:"12",xs:"12",sm:"6",md:"6",lg:"4",xl:"4"}},[s("v-card",{staticClass:"fill-height full-width",attrs:{elevation:"0"}},[s("v-card-text",{staticClass:"d-flex align-center fill-height pa-0 card-border"},[s("v-btn",{staticClass:"transparent fill-height",attrs:{depressed:"",block:"",height:"80"},on:{click:function(s){return e.addFile(t)}}},[s("v-icon",{staticClass:"font-22",attrs:{color:"primary"}},[e._v(" mdi-plus ")])],1)],1)],1)],1)],2)],1)})),1)],2)},r=[],a=(s("99af"),s("4de4"),s("c740"),s("0481"),s("caad"),s("d81d"),s("a434"),s("4069"),s("b0c0"),s("a9e3"),s("07ac"),s("2532"),s("2ca0"),s("2909")),n=s("5530"),o=(s("96cf"),s("1da1")),l=s("b85c"),c=s("2b0e"),d=s("5acd"),u=s("de5b"),m=s("a1c6"),v=s("8350"),h=c["a"].extend({name:"Documents",components:{Comments:v["a"],FileUploader:d["a"]},props:{orderType:{type:[String,Number],required:!0},area:{type:[String,Number],required:!1},extraRules:{type:Array,required:!1},documents:{type:Array,required:!1},preview:{type:Boolean,required:!1,default:!1},commentsReadonly:{type:Boolean,required:!1,default:!1},showComments:{type:Boolean,required:!1,default:!1},comments:{type:Object,required:!1,default:function(){return{}}},errorMessages:{type:Object,required:!1,default:function(){return{}}}},data:function(){return{rules:u["a"],documentsModel:m,docsModel:{},obligatoryDocuments:[],extraDocuments:{other:{extra:[]},agro:{constatation:[],authority:[]}},extraDocs:[]}},watch:{area:{handler:function(){if(this.area){var e,t=this.documentsModel[this.orderType],s=Object(l["a"])(t.extra[this.area]);try{for(s.s();!(e=s.n()).done;){var i=e.value;this.extraDocuments[this.area][i]=[{file:null,file_type:i}]}}catch(r){s.e(r)}finally{s.f()}}}},orderType:{immediate:!0,deep:!0,handler:function(){this.docsModel=this.documentsModel[this.orderType]}},comments:{deep:!0,handler:function(){this.$forceUpdate()}}},mounted:function(){this.generateFields()},methods:{modifyDocuments:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.extraDocs=Object.values(e.extraDocuments[e.area]).map((function(e){return e.filter((function(e){return e.file&&e.file.name})).map((function(e){return Object(n["a"])(Object(n["a"])({},e),{},{file_type:e.file_type})}))})),e.$emit("update",[].concat(Object(a["a"])(e.obligatoryDocuments),Object(a["a"])(e.extraDocs.flat())));case 2:case"end":return t.stop()}}),t)})))()},addFile:function(e){this.extraDocuments[this.area][e].push({file:null,file_type:"".concat(e,".").concat(this.extraDocuments[this.area][e].length)}),this.$forceUpdate()},deleteFile:function(e,t){this.extraDocuments[this.area][e].splice(t,1),this.$forceUpdate()},generateFields:function(){var e=this,t=this.documentsModel[this.orderType];if(this.setUpExtraDocuments(),!this.documents&&t.obligatory){var s,i=Object(l["a"])(t.obligatory);try{for(i.s();!(s=i.n()).done;){var r=s.value;this.obligatoryDocuments.push({file:null,file_type:r})}}catch(u){i.e(u)}finally{i.f()}}else{var n;if(t.obligatory)this.obligatoryDocuments=Object(a["a"])(null===(n=this.documents)||void 0===n?void 0:n.filter((function(e){return t.obligatory.includes(e.file_type)})));var o,c=Object(l["a"])(t.extra[this.area]);try{var d=function(){var t=o.value;e.extraDocuments[e.area][t]=Object(a["a"])(e.documents.filter((function(e){return e.file_type.startsWith(t)})))};for(c.s();!(o=c.n()).done;)d()}catch(u){c.e(u)}finally{c.f()}}this.$forceUpdate()},setUpExtraDocuments:function(){if(this.area){var e,t=Object(l["a"])(this.docsModel.extra[this.area]);try{for(t.s();!(e=t.n()).done;){var s=e.value;this.extraDocuments[this.area][s]=[]}}catch(i){t.e(i)}finally{t.f()}}},updateComments:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:t.$emit("getComments",e);case 1:case"end":return s.stop()}}),s)})))()},getErrorMessage:function(e){var t=[].concat(Object(a["a"])(this.obligatoryDocuments),Object(a["a"])(this.extraDocs.flat())),s=t.findIndex((function(t){return t.file_type===e}));return-1!==s?this.errorMessages["documents.".concat(s,".file")]:[]}}}),f=h,p=(s("8bdc"),s("2877")),_=s("6544"),g=s.n(_),y=s("8336"),b=s("b0af"),x=s("99d9"),C=s("62ad"),w=s("132d"),S=s("0fd9"),k=s("3a2f"),$=Object(p["a"])(f,i,r,!1,null,"1daa5577",null);t["a"]=$.exports;g()($,{VBtn:y["a"],VCard:b["a"],VCardText:x["c"],VCol:C["a"],VIcon:w["a"],VRow:S["a"],VTooltip:k["a"]})},"1c46":function(e,t,s){},"1f09":function(e,t,s){},"1f4f":function(e,t,s){"use strict";s("a9e3");var i=s("5530"),r=(s("8b37"),s("80d2")),a=s("7560"),n=s("58df");t["a"]=Object(n["a"])(a["a"]).extend({name:"v-simple-table",props:{dense:Boolean,fixedHeader:Boolean,height:[Number,String]},computed:{classes:function(){return Object(i["a"])({"v-data-table--dense":this.dense,"v-data-table--fixed-height":!!this.height&&!this.fixedHeader,"v-data-table--fixed-header":this.fixedHeader,"v-data-table--has-top":!!this.$slots.top,"v-data-table--has-bottom":!!this.$slots.bottom},this.themeClasses)}},methods:{genWrapper:function(){return this.$slots.wrapper||this.$createElement("div",{staticClass:"v-data-table__wrapper",style:{height:Object(r["g"])(this.height)}},[this.$createElement("table",this.$slots.default)])}},render:function(e){return e("div",{staticClass:"v-data-table",class:this.classes},[this.$slots.top,this.genWrapper(),this.$slots.bottom])}})},3129:function(e,t,s){"use strict";s("a630"),s("c975"),s("d81d"),s("ac1f"),s("3ca3"),s("5319"),s("1276");var i=s("3835"),r=s("5530"),a=(s("1f09"),s("c995")),n=s("24b2"),o=s("7560"),l=s("58df"),c=s("80d2");t["a"]=Object(l["a"])(a["a"],n["a"],o["a"]).extend({name:"VSkeletonLoader",props:{boilerplate:Boolean,loading:Boolean,tile:Boolean,transition:String,type:String,types:{type:Object,default:function(){return{}}}},computed:{attrs:function(){return this.isLoading?this.boilerplate?{}:Object(r["a"])({"aria-busy":!0,"aria-live":"polite",role:"alert"},this.$attrs):this.$attrs},classes:function(){return Object(r["a"])(Object(r["a"])({"v-skeleton-loader--boilerplate":this.boilerplate,"v-skeleton-loader--is-loading":this.isLoading,"v-skeleton-loader--tile":this.tile},this.themeClasses),this.elevationClasses)},isLoading:function(){return!("default"in this.$scopedSlots)||this.loading},rootTypes:function(){return Object(r["a"])({actions:"button@2",article:"heading, paragraph",avatar:"avatar",button:"button",card:"image, card-heading","card-avatar":"image, list-item-avatar","card-heading":"heading",chip:"chip","date-picker":"list-item, card-heading, divider, date-picker-options, date-picker-days, actions","date-picker-options":"text, avatar@2","date-picker-days":"avatar@28",heading:"heading",image:"image","list-item":"text","list-item-avatar":"avatar, text","list-item-two-line":"sentences","list-item-avatar-two-line":"avatar, sentences","list-item-three-line":"paragraph","list-item-avatar-three-line":"avatar, paragraph",paragraph:"text@3",sentences:"text@2",table:"table-heading, table-thead, table-tbody, table-tfoot","table-heading":"heading, text","table-thead":"heading@6","table-tbody":"table-row-divider@6","table-row-divider":"table-row, divider","table-row":"table-cell@6","table-cell":"text","table-tfoot":"text@2, avatar@2",text:"text"},this.types)}},methods:{genBone:function(e,t){return this.$createElement("div",{staticClass:"v-skeleton-loader__".concat(e," v-skeleton-loader__bone")},t)},genBones:function(e){var t=this,s=e.split("@"),r=Object(i["a"])(s,2),a=r[0],n=r[1],o=function(){return t.genStructure(a)};return Array.from({length:n}).map(o)},genStructure:function(e){var t=[];e=e||this.type||"";var s=this.rootTypes[e]||"";if(e===s);else{if(e.indexOf(",")>-1)return this.mapBones(e);if(e.indexOf("@")>-1)return this.genBones(e);s.indexOf(",")>-1?t=this.mapBones(s):s.indexOf("@")>-1?t=this.genBones(s):s&&t.push(this.genStructure(s))}return[this.genBone(e,t)]},genSkeleton:function(){var e=[];return this.isLoading?e.push(this.genStructure()):e.push(Object(c["s"])(this)),this.transition?this.$createElement("transition",{props:{name:this.transition},on:{afterEnter:this.resetStyles,beforeEnter:this.onBeforeEnter,beforeLeave:this.onBeforeLeave,leaveCancelled:this.resetStyles}},e):e},mapBones:function(e){return e.replace(/\s/g,"").split(",").map(this.genStructure)},onBeforeEnter:function(e){this.resetStyles(e),this.isLoading&&(e._initialStyle={display:e.style.display,transition:e.style.transition},e.style.setProperty("transition","none","important"))},onBeforeLeave:function(e){e.style.setProperty("display","none","important")},resetStyles:function(e){e._initialStyle&&(e.style.display=e._initialStyle.display||"",e.style.transition=e._initialStyle.transition,delete e._initialStyle)}},render:function(e){return e("div",{staticClass:"v-skeleton-loader",attrs:this.attrs,on:this.$listeners,class:this.classes,style:this.isLoading?this.measurableStyles:void 0},[this.genSkeleton()])}})},"3a60":function(e,t,s){(function(t,s){e.exports=s()})(0,(function(){return function(e){function t(i){if(s[i])return s[i].exports;var r=s[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var s={};return t.m=e,t.c=s,t.i=function(e){return e},t.d=function(e,s,i){t.o(e,s)||Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p=".",t(t.s=10)}([function(e,t){e.exports={"#":{pattern:/\d/},X:{pattern:/[0-9a-zA-Z]/},S:{pattern:/[a-zA-Z]/},A:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleUpperCase()}},a:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleLowerCase()}},"!":{escape:!0}}},function(e,t,s){"use strict";function i(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!0),t}var r=s(2),a=s(0),n=s.n(a);t.a=function(e,t){var a=t.value;if((Array.isArray(a)||"string"==typeof a)&&(a={mask:a,tokens:n.a}),"INPUT"!==e.tagName.toLocaleUpperCase()){var o=e.getElementsByTagName("input");if(1!==o.length)throw new Error("v-mask directive requires 1 input, found "+o.length);e=o[0]}e.oninput=function(t){if(t.isTrusted){var n=e.selectionEnd,o=e.value[n-1];for(e.value=s.i(r.a)(e.value,a.mask,!0,a.tokens);n<e.value.length&&e.value.charAt(n-1)!==o;)n++;e===document.activeElement&&(e.setSelectionRange(n,n),setTimeout((function(){e.setSelectionRange(n,n)}),0)),e.dispatchEvent(i("input"))}};var l=s.i(r.a)(e.value,a.mask,!0,a.tokens);l!==e.value&&(e.value=l,e.dispatchEvent(i("input")))}},function(e,t,s){"use strict";var i=s(6),r=s(5);t.a=function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments[3];return Array.isArray(t)?s.i(r.a)(i.a,t,n)(e,t,a,n):s.i(i.a)(e,t,a,n)}},function(e,t,s){"use strict";function i(e){e.component(l.a.name,l.a),e.directive("mask",n.a)}Object.defineProperty(t,"__esModule",{value:!0});var r=s(0),a=s.n(r),n=s(1),o=s(7),l=s.n(o);s.d(t,"TheMask",(function(){return l.a})),s.d(t,"mask",(function(){return n.a})),s.d(t,"tokens",(function(){return a.a})),s.d(t,"version",(function(){return c}));var c="0.11.1";t.default=i,"undefined"!=typeof window&&window.Vue&&window.Vue.use(i)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(1),r=s(0),a=s.n(r),n=s(2);t.default={name:"TheMask",props:{value:[String,Number],mask:{type:[String,Array],required:!0},masked:{type:Boolean,default:!1},tokens:{type:Object,default:function(){return a.a}}},directives:{mask:i.a},data:function(){return{lastValue:null,display:this.value}},watch:{value:function(e){e!==this.lastValue&&(this.display=e)},masked:function(){this.refresh(this.display)}},computed:{config:function(){return{mask:this.mask,tokens:this.tokens,masked:this.masked}}},methods:{onInput:function(e){e.isTrusted||this.refresh(e.target.value)},refresh:function(e){this.display=e;e=s.i(n.a)(e,this.mask,this.masked,this.tokens);e!==this.lastValue&&(this.lastValue=e,this.$emit("input",e))}}}},function(e,t,s){"use strict";function i(e,t,s){return t=t.sort((function(e,t){return e.length-t.length})),function(i,r){for(var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;n<t.length;){var o=t[n];n++;var l=t[n];if(!(l&&e(i,l,!0,s).length>o.length))return e(i,o,a,s)}return""}}t.a=i},function(e,t,s){"use strict";function i(e,t){var s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments[3];e=e||"",t=t||"";for(var r=0,a=0,n="";r<t.length&&a<e.length;){var o=t[r],l=i[o],c=e[a];l&&!l.escape?(l.pattern.test(c)&&(n+=l.transform?l.transform(c):c,r++),a++):(l&&l.escape&&(r++,o=t[r]),s&&(n+=o),c===o&&a++,r++)}for(var d="";r<t.length&&s;){o=t[r];if(i[o]){d="";break}d+=o,r++}return n+d}t.a=i},function(e,t,s){var i=s(8)(s(4),s(9),null,null);e.exports=i.exports},function(e,t){e.exports=function(e,t,s,i){var r,a=e=e||{},n=typeof e.default;"object"!==n&&"function"!==n||(r=e,a=e.default);var o="function"==typeof a?a.options:a;if(t&&(o.render=t.render,o.staticRenderFns=t.staticRenderFns),s&&(o._scopeId=s),i){var l=o.computed||(o.computed={});Object.keys(i).forEach((function(e){var t=i[e];l[e]=function(){return t}}))}return{esModule:r,exports:a,options:o}}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("input",{directives:[{name:"mask",rawName:"v-mask",value:e.config,expression:"config"}],attrs:{type:"text"},domProps:{value:e.display},on:{input:e.onInput}})},staticRenderFns:[]}},function(e,t,s){e.exports=s(3)}])}))},"8b37":function(e,t,s){},"8bdc":function(e,t,s){"use strict";s("1c46")},"99fe":function(e,t,s){},"9d01":function(e,t,s){},ab20:function(e,t,s){},b1e7:function(e,t,s){"use strict";s("99fe")},b65f:function(e,t,s){var i=s("23e7"),r=Math.ceil,a=Math.floor;i({target:"Math",stat:!0},{trunc:function(e){return(e>0?a:r)(e)}})},b73d:function(e,t,s){"use strict";s("0481"),s("4069");var i=s("5530"),r=(s("ec29"),s("9d01"),s("fe09")),a=s("c37a"),n=s("c3f0"),o=s("0789"),l=s("490a"),c=s("80d2");t["a"]=r["a"].extend({name:"v-switch",directives:{Touch:n["a"]},props:{inset:Boolean,loading:{type:[Boolean,String],default:!1},flat:{type:Boolean,default:!1}},computed:{classes:function(){return Object(i["a"])(Object(i["a"])({},a["a"].options.computed.classes.call(this)),{},{"v-input--selection-controls v-input--switch":!0,"v-input--switch--flat":this.flat,"v-input--switch--inset":this.inset})},attrs:function(){return{"aria-checked":String(this.isActive),"aria-disabled":String(this.isDisabled),role:"switch"}},validationState:function(){return this.hasError&&this.shouldValidate?"error":this.hasSuccess?"success":null!==this.hasColor?this.computedColor:void 0},switchData:function(){return this.setTextColor(this.loading?void 0:this.validationState,{class:this.themeClasses})}},methods:{genDefaultSlot:function(){return[this.genSwitch(),this.genLabel()]},genSwitch:function(){return this.$createElement("div",{staticClass:"v-input--selection-controls__input"},[this.genInput("checkbox",Object(i["a"])(Object(i["a"])({},this.attrs),this.attrs$)),this.genRipple(this.setTextColor(this.validationState,{directives:[{name:"touch",value:{left:this.onSwipeLeft,right:this.onSwipeRight}}]})),this.$createElement("div",Object(i["a"])({staticClass:"v-input--switch__track"},this.switchData)),this.$createElement("div",Object(i["a"])({staticClass:"v-input--switch__thumb"},this.switchData),[this.genProgress()])])},genProgress:function(){return this.$createElement(o["c"],{},[!1===this.loading?null:this.$slots.progress||this.$createElement(l["a"],{props:{color:!0===this.loading||""===this.loading?this.color||"primary":this.loading,size:16,width:2,indeterminate:!0}})])},onSwipeLeft:function(){this.isActive&&this.onChange()},onSwipeRight:function(){this.isActive||this.onChange()},onKeydown:function(e){(e.keyCode===c["y"].left&&this.isActive||e.keyCode===c["y"].right&&!this.isActive)&&this.onChange()}}})},b755:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-card",{staticClass:"full-width"},[s("v-card-title",[e._v(e._s(e.$t("orders.services.title"))+" ")]),s("v-card-text",[s("v-simple-table",{staticClass:"full-width"},[s("thead",[s("tr",[s("th",[e._v(e._s(e.$t("orders.services.service")))]),e.isEdit?s("th",[e._v(" "+e._s(e.$t("orders.services.date_created"))+" ")]):e._e(),e.isEdit?e._e():s("th"),s("th",{staticStyle:{width:"5em"}},[e._v(" "+e._s(e.$t("orders.services.units"))+" ")]),s("th",{staticStyle:{width:"11em"}},[e._v(" "+e._s(e.$t("orders.services.sum_no_vat"))+" ")]),s("th",{staticStyle:{width:"11em"}},[e._v(" "+e._s(e.$t("orders.services.sum_with_vat"))+" ")]),e.isEdit?[s("th",{staticStyle:{width:"10em"}},[e._v(" "+e._s(e.$t("orders.services.paid_sum"))+" ")]),s("th",{staticStyle:{width:"13em"}},[e._v(" "+e._s(e.$t("orders.services.remained_sum"))+" ")]),e.isEdit?s("th"):e._e()]:e._e()],2)]),s("tbody",{key:e.forceKey},[e._l(e.model.details.services,(function(t,i){return s("tr",{key:i,class:{"deleted-service":t._isDeleted}},[s("td",{staticStyle:{width:"350px"}},[s("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(i){var r=i.on,a=i.attrs;return[s("span",e._g(e._b({staticClass:"overflow-hidden text-no-wrap"},"span",a,!1),r),[e._v(" "+e._s(t.name)+" ")])]}}],null,!0)},[s("span",[e._v(" "+e._s(t.name)+" ")])])],1),s("td",{staticClass:"text-right text-no-wrap"},[e._v(" "+e._s(t.created_at)+" ")]),s("td",{staticClass:"text-right"},[e._v(e._s(t.quantity))]),s("td",{staticClass:"text-right"},[t.editable?s("v-text-field",{attrs:{type:"number","hide-details":"",dense:""},on:{input:function(t){return e.updateVat(i)}},model:{value:t.sum_no_vat,callback:function(s){e.$set(t,"sum_no_vat",s)},expression:"service.sum_no_vat"}}):s("span",[e._v(" "+e._s(t.sum_no_vat)+" ")])],1),s("td",{staticClass:"text-right"},[s("span",[e._v(" "+e._s(t.sum_with_vat)+" ")])]),e.isEdit?[s("td",{staticClass:"text-right"},[e._v(" "+e._s(t.paid_sum)+" ")]),s("td",{staticClass:"text-right"},[e._v(" "+e._s(t.remained_sum)+" ")]),e.disabled?e._e():s("td",[e.can("delete",t.alias)&&0===t.paid_sum&&!t._isDeleted?s("v-btn",{attrs:{small:"",icon:"",title:e.$t("orders.services.alert.delete")},on:{click:function(s){return e.toggleDeleteService(t)}}},[s("v-icon",{attrs:{color:"error",small:""}},[e._v("mdi-close")])],1):e._e(),t._isDeleted?s("v-btn",{attrs:{small:"",icon:"",title:e.$t("orders.services.alert.undo_delete")},on:{click:function(s){return e.toggleDeleteService(t)}}},[s("v-icon",{attrs:{color:"error",small:""}},[e._v("mdi-undo-variant")])],1):e._e()],1)]:e._e()],2)})),(e.extraVisitsAfter>0||0===e.extraVisitsAfter&&e.isDataChanged)&&this.canAddExtraServices?s("tr",[s("td",{staticClass:"mt-4 font-weight-bold",attrs:{colspan:"4"}},[e._v(" "+e._s(e.$t("orders.form.fields.extra_services"))+" ")]),e.isEdit?s("td",{attrs:{colspan:"4"}}):e._e()]):e._e(),e.extraVisitsAfter>0&&this.canAddExtraServices?s("tr",[s("td",[e._v(" "+e._s(e.services.extra_visits_after&&e.services.extra_visits_after.text)+" ")]),s("td"),s("td",{staticClass:"text-right"},[e._v(e._s(e.extraVisitsAfter))]),s("td",{staticClass:"text-right"},[e._v(" "+e._s(e.extraVisitsAfterSum)+" ")]),s("td",{staticClass:"text-right"},[e._v(" "+e._s(e.addVat(e.extraVisitsAfterSum))+" ")]),e.isEdit?s("td",{attrs:{colspan:"3"}}):e._e()]):e._e(),e.isDataChanged&&0===e.extraVisitsAfter&&this.canAddExtraServices?s("tr",[s("td",[e._v(" "+e._s(e.services.data_edit&&e.services.data_edit.text)+" ")]),e.isEdit?s("td",{staticClass:"text-right"}):e._e(),s("td",{staticClass:"text-right"},[e._v("1")]),s("td",{staticClass:"text-right"},[e._v(" "+e._s(e.dataEditSum)+" ")]),s("td",{staticClass:"text-right"},[e._v(" "+e._s(e.addVat(e.dataEditSum))+" ")]),e.isEdit?s("td",{attrs:{colspan:"3"}}):e._e()]):e._e()],2),s("tfoot",[s("tr",[s("th"),s("th"),s("th",{staticClass:"text-right"},[e._v(" "+e._s(e.$t("orders.services.total"))+" ")]),s("th",{staticClass:"text-right"},[e._v(" "+e._s(e.servicesTotalSum&&e.servicesTotalSum.toFixed(2))+" ")]),s("th",{staticClass:"text-right"},[e._v(" "+e._s(e.servicesVatTotalSum&&e.servicesVatTotalSum.toFixed(2))+" ")]),e.isEdit?[s("th",{staticClass:"text-right"},[e._v(" "+e._s(e.totalPayedServiceSUm&&e.totalPayedServiceSUm.toFixed(2))+" ")]),s("th",{staticClass:"text-right"},[e._v(" "+e._s(e.totalRemainedForPayServiceSUm&&e.totalRemainedForPayServiceSUm.toFixed(2))+" ")])]:e._e()],2)])])],1)],1),e.showGuarantee?s("v-card",{staticClass:"mt-2"},[s("v-card-title",[e._v(e._s(e.$t("orders.services.guarantee")))]),s("v-card-text",[s("v-row",[e.disabled?e._e():s("v-col",{attrs:{cols:"6"}},[s("v-switch",{attrs:{label:e.$t("orders.services.guarantee_required")},on:{change:function(t){return e.setGuaranteePrice()}},model:{value:e.model.details.guaranty_required,callback:function(t){e.$set(e.model.details,"guaranty_required",t)},expression:"model.details.guaranty_required"}}),s("v-switch",{staticStyle:{visibility:"hidden"},attrs:{label:"Ata exposition"},model:{value:e.model.order.for_cci_exposition,callback:function(t){e.$set(e.model.order,"for_cci_exposition",t)},expression:"model.order.for_cci_exposition"}})],1),s("v-col",[s("v-text-field",{attrs:{type:"number",min:"0",label:e.$t("orders.form.fields.required_guaranty_sum"),disabled:!e.model.details.guaranty_required},model:{value:e.model.details.required_guaranty_sum,callback:function(t){e.$set(e.model.details,"required_guaranty_sum",t)},expression:"model.details.required_guaranty_sum"}})],1)],1)],1)],1):e._e(),e.isEdit?s("v-row",{staticClass:"mt-4"},[s("v-col",[s("div",{staticClass:"d-flex"},[s("v-spacer"),s("v-btn",{staticClass:"ml-3",attrs:{outlined:"",color:"primary"},on:{click:function(t){return e.previewReceipt()}}},[s("v-icon",[e._v("mdi-printer")]),s("span",{staticClass:"ml-1"},[e._v(e._s(e.$t("orders.services.buttons.print_invoice")))])],1)],1)])],1):e._e()],1)],1)},r=[],a=(s("7db0"),s("c740"),s("4160"),s("caad"),s("13d5"),s("a434"),s("b65f"),s("a9e3"),s("d3b7"),s("2532"),s("159b"),s("ddb0"),s("5530")),n=s("b85c"),o=(s("96cf"),s("1da1")),l=s("2b0e"),c=s("3557"),d=l["a"].extend({name:"OrderServices",props:{value:{required:!0,default:function(){return{}}},showGuarantee:{type:Boolean,default:!1,required:!1},disabled:{required:!1,type:Boolean,default:!1},oldValue:{required:!1,type:Object,default:function(){return{}}},newServices:{required:!1,default:function(){return{}}},isEdit:{required:!1,default:!1,type:Boolean},extraOutputs:{required:!1,default:!1},serviceTypeId:{required:!1,default:null}},data:function(){return{model:{},goods:[],outputs:null,beneficiary:null,releaseMode:null,ataExpositon:null,oldModel:null,services:{},serviceId:null,orderServices:[],totalRemainedForPayServiceSUm:0,totalPayedServiceSUm:0,servicesVatTotalSum:0,servicesTotalSum:0,forceKey:0}},watch:{value:{immediate:!0,deep:!0,handler:function(){this.model=this.value,this.isEdit?this.serviceId=this.model.order.service_type_id:this.serviceId=this.serviceTypeId,this.beneficiary=this.model.order.client,1===this.serviceId&&(this.goods=this.model.details.goods,this.outputs=this.model.details.outputs,this.releaseMode=this.model.order.release_mode,this.ataExpositon=this.model.order.for_cci_exposition),this.calculateSums()}},oldValue:{immediate:!0,handler:function(){this.oldModel=this.oldValue}},extraVisitsAfter:{immediate:!0,handler:function(){this.extraVisitsAfter>0?this.$emit("extraVisitsAfter",{service_id:this.services.extra_visits_after.value,sum_no_vat:this.extraVisitsAfterSum,sum_with_vat:this.addVat(this.extraVisitsAfterSum),quantity:this.extraVisitsAfter}):this.$emit("extraVisitsAfter",null)}},isDataChanged:{immediate:!0,handler:function(){var e,t;this.isDataChanged&&0===this.extraVisitsAfter?this.$emit("dataEdit",{service_id:null===(e=this.services)||void 0===e||null===(t=e.data_edit)||void 0===t?void 0:t.value,sum_no_vat:this.dataEditSum,sum_with_vat:this.addVat(this.dataEditSum),quantity:1}):this.$emit("dataEdit",null)}},additionalSum:{immediate:!0,handler:function(){this.$emit("additionalSumChange",this.additionalSum)}},goods:{immediate:!0,deep:!0,handler:function(){this.goods&&this.goods.length&&this.setGoodsService()}},outputs:{immediate:!0,deep:!0,handler:function(){this.outputs&&this.setOutputsService()}},beneficiary:{immediate:!0,deep:!0,handler:function(){this.beneficiary&&this.setBeneficiaryService()}},releaseMode:{immediate:!0,handler:function(){this.releaseMode&&this.setReleaseModeService()}},ataExpositon:{immediate:!0,handler:function(){this.setCciExpositionService()}}},computed:{extraVisitsAfter:function(){return Number(this.extraOutputs)},dataEditSum:function(){return this.isDataChanged&&0===this.extraVisitsAfter?this.getServicePrice(this.services.data_edit):0},additionalSum:function(){return this.extraVisitsAfterSum+this.dataEditSum},isDataChanged:function(){return JSON.stringify(this.model)!==this.oldModel},canAddExtraServices:function(){var e,t,s;return"issued"===(null===(e=this.model)||void 0===e||null===(t=e.order)||void 0===t||null===(s=t.status)||void 0===s?void 0:s.alias)},goodsSum:function(){var e;return null===(e=this.model.details.goods)||void 0===e?void 0:e.reduce((function(e,t){var s=t.quantity,i=t.price;return s&&i?e+i*s:e}),0)}},mounted:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getServices();case 2:case"end":return t.stop()}}),t)})))()},methods:{getServices:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var s,i,r,a,o,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$API.services().getListByServiceType(e.serviceId);case 3:r=t.sent,a=Object(n["a"])(r);try{for(a.s();!(o=a.n()).done;)l=o.value,e.services[l.alias]=l}catch(c){a.e(c)}finally{a.f()}null===(s=e.model.details)||void 0===s||null===(i=s.services)||void 0===i||i.forEach((function(t){return t.editable=e.services[t.alias].editable})),t.next=13;break;case 9:return t.prev=9,t.t0=t["catch"](0),t.next=13,e.$store.dispatch("alert/showError",t.t0.message||t.t0);case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))()},setGoodsService:function(){var e="extra_positions";if(this.model.details.goods.length>1){var t=this.getServicePrice(this.services[e],this.goods.length,1);if(this.services.extra_positions){var s={service_id:this.services[e].value,sum_no_vat:t,sum_with_vat:this.addVat(t),quantity:this.goods.length-1,name:this.services[e].text};this.checkService(e,s)}}else this.removeService(e)},setBeneficiaryService:function(){if(this.beneficiary)if(1===this.serviceId){var e="".concat(this.beneficiary.type,"_normal");this.removeService("_normal",!0);var t=this.getServicePrice(this.services[e]),s=t;if("physical"!==this.beneficiary.type&&(s=this.addVat(t)),this.services[e]){var i={service_id:this.services[e].value,sum_no_vat:t,sum_with_vat:s,quantity:1,name:this.services[e].text};this.checkService(e,i),this.setReleaseModeService()}}else 2===this.serviceId&&this.setAAIJService();else this.removeService("_normal",!0)},setReleaseModeService:function(){if(this.services&&"urgent"===this.releaseMode){var e,t;this.$emit("remove",[null===(e=this.services.juridical_urgent)||void 0===e?void 0:e.value,null===(t=this.services.physical_urgent)||void 0===t?void 0:t.value]);var s="".concat(this.beneficiary.type,"_urgent"),i=this.getServicePrice(this.services[s]),r=i;if("physical"!==this.beneficiary.type&&(r=this.addVat(i)),this.services[s]){var a={service_id:this.services[s].value,sum_no_vat:i,sum_with_vat:r,quantity:1,name:this.services[s].text};this.checkService(s,a)}}else if(this.services){var n,o;this.$emit("remove",[null===(n=this.services.juridical_urgent)||void 0===n?void 0:n.value,null===(o=this.services.physical_urgent)||void 0===o?void 0:o.value])}},setOutputsService:function(){var e="extra_visit";if(this.outputs>1){var t=this.getServicePrice(this.services[e],this.outputs-1);if(this.services[e]){var s={service_id:this.services[e].value,sum_no_vat:t,sum_with_vat:this.addVat(t),quantity:this.outputs-1,name:this.services[e].text};this.checkService(e,s)}}else this.removeService(e)},setCciExpositionService:function(){var e="ata_exposition_discount";if(this.ataExpositon){var t=this.getServicePrice(this.services["".concat(this.beneficiary.type,"_normal")]),s=-(t-t*(100-this.getServicePrice(this.services.ata_exposition_discount))/100);if(this.services[e]){var i={service_id:this.services[e].value,sum_no_vat:s,sum_with_vat:s,quantity:1,name:this.services[e].text};this.checkService(e,i)}else{var r;this.$emit("remove",null===(r=this.services[e])||void 0===r?void 0:r.value)}}else this.removeService(e)},checkService:function(e,t){this.$emit("setService",Object(a["a"])(Object(a["a"])({},t),{},{editable:this.services[e].editable}))},setAAIJService:function(){if(2===this.serviceId){var e="aaij",t=this.getServicePrice(this.services.aaij);if(this.services[e]){var s={service_id:this.services[e].value,sum_no_vat:t,sum_with_vat:this.addVat(t),quantity:1,name:this.services[e].text};this.checkService(e,s)}}},removeService:function(e){var t,s,i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r?this.$emit("remove",[null===(t=this.services.juridical_normal)||void 0===t?void 0:t.value,null===(s=this.services.physical_normal)||void 0===s?void 0:s.value]):this.$emit("remove",null===(i=this.services[e])||void 0===i?void 0:i.value)},addVat:function(e){return e+20*e/100},setGuaranteePrice:function(){this.model.details.guaranty_required&&(this.model.details.required_guaranty_sum=Math.trunc(.3*this.goodsSum)||0)},getServicePrice:function(e){var t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e&&e.values?Number(null===(t=e.values.find((function(e){return s>=e.min&&s<=e.max})))||void 0===t?void 0:t.value)*(s-i):0},previewReceipt:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$API.invoices().getFileForPrint(e.model.order.id);case 3:s=t.sent,s&&s.url&&e.downloadFile(s),t.next=11;break;case 7:return t.prev=7,t.t0=t["catch"](0),t.next=11,e.$store.dispatch("alert/showError",t.t0.message);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},toggleDeleteService:function(e){e._isDeleted=!e._isDeleted,"ata_exposition_discount"===e.alias&&(this.model.order.for_cci_exposition=!e._isDeleted),this.$forceUpdate()},can:function(e,t){return c.actions.includes(e)&&!c.subject.includes(t)},downloadFile:function(e){var t=document.createElement("a");t.setAttribute("href",e.url),t.setAttribute("target","_blank"),t.click()},changeReleaseService:function(){var e=this,t=this.services["".concat(this.beneficiary.type,"_urgent")];if(t&&"urgent"===this.release_mode)this.model.details.services.push({name:t.text,service_id:t.value,sum_no_vat:this.getServicePrice(t),sum_with_vat:this.addVat(this.getServicePrice(t)),quantity:1});else if(t&&"normal"===this.release_mode){var s,i=this.model.details.services.findIndex((function(t){return t.alias==="".concat(e.beneficiary.type,"_urgent")}));if(-1!==i)null===(s=this.model.details.services)||void 0===s||s.splice(i,1)}this.forceKey++},updateVat:function(e){this.$emit("updateVat",e),this.calculateSums()},calculateSums:function(){var e,t;if(null!==(e=this.model)&&void 0!==e&&null!==(t=e.details)&&void 0!==t&&t.services){var s=this.model.details.services;this.servicesTotalSum=null===s||void 0===s?void 0:s.reduce((function(e,t){var s=t.sum_no_vat;return s?e+Number(s):e}),0),this.servicesVatTotalSum=null===s||void 0===s?void 0:s.reduce((function(e,t){var s=t.sum_with_vat;return s?e+Number(s):e}),0),this.totalPayedServiceSUm=null===s||void 0===s?void 0:s.reduce((function(e,t){var s=t.paid_sum;return s?e+Number(s):e}),0),this.totalRemainedForPayServiceSUm=null===s||void 0===s?void 0:s.reduce((function(e,t){var s=t.remained_sum;return s?e+Number(s):e}),0),this.$emit("input",this.model.details.services.reduce((function(e,t){var s=t.sum_with_vat;return s?e+Number(s):e}),0))}}}}),u=d,m=(s("b1e7"),s("2877")),v=s("6544"),h=s.n(v),f=s("8336"),p=s("b0af"),_=s("99d9"),g=s("62ad"),y=s("132d"),b=s("0fd9"),x=s("1f4f"),C=s("2fa4"),w=s("b73d"),S=s("8654"),k=s("3a2f"),$=Object(m["a"])(u,i,r,!1,null,"c6343c56",null);t["a"]=$.exports;h()($,{VBtn:f["a"],VCard:p["a"],VCardText:_["c"],VCardTitle:_["d"],VCol:g["a"],VIcon:y["a"],VRow:b["a"],VSimpleTable:x["a"],VSpacer:C["a"],VSwitch:w["a"],VTextField:S["a"],VTooltip:k["a"]})},bcfa:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-row",{staticClass:"py-2"},[e.loading?s("v-skeleton-loader",{staticClass:"mt-16 pt-4",staticStyle:{"max-width":"1400px","min-height":"75vh"},attrs:{width:"100%",type:"card-avatar, article, list-item-three-line, list-item-three-line, actions"}}):s("v-card",{staticClass:"elevation-4 px-4 py-2 mb-3",attrs:{width:"100%"}},[s("v-card-text",{staticClass:"pa-0"},[0===e.selectedTab?s("v-row",{staticClass:"actions mt-0"},[s("v-col",{staticClass:"pa-2 d-flex align-center"},[s("span",{staticClass:"caption ml-3"},[e._v(" "+e._s(e.$t("global-validation.is_required"))+" ")]),s("v-spacer"),s("v-btn",{attrs:{link:"",to:"/orders",text:""}},[e._v(" "+e._s(e.$t("global-buttons.close"))+" ")]),s("v-btn",{staticClass:"ml-2",attrs:{color:"primary",depressed:"",disabled:e.isLoading},on:{click:e.submit}},[e.isLoading?s("v-progress-circular",{staticStyle:{position:"absolute"},attrs:{indeterminate:"",color:"primary"}}):e._e(),e._v(" "+e._s(e.$t("global-buttons.confirm"))+" ")],1)],1)],1):e._e(),s("v-tabs",{staticClass:"mb-2",attrs:{"align-with-title":""},model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[s("v-tab",{key:"order"},[s("span",[e._v(e._s(e.$t("orders.tabs.create")))])]),s("v-tab",{key:"services",staticClass:"text-no-wrap",attrs:{disabled:!e.isSelectBeneficiary}},[s("span",[e._v(e._s(e.$t("orders.tabs.services")))]),e.totalSum>0?s("span",[e._v(" "+e._s("("+e.totalSum.toFixed(2)+" MDL)"))]):e._e()])],1),s("v-tabs-items",{model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[s("v-tab-item",{key:"order",attrs:{eager:""}},[s("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var i=t.hover;return[s("v-card",{staticClass:"elevation-4 px-4 py-2 position-relative",class:{placeholder:i&&!e.isSelectBeneficiary},attrs:{width:"100%"}},[s("v-card-text",{staticClass:"pa-0"},[s("v-form",{directives:[{name:"handle-unsaved",rawName:"v-handle-unsaved"}],ref:"form",staticClass:"d-flex flex-column justify-center"},[s("v-row",{staticClass:"pt-8 mx-2"},[s("v-col",{attrs:{cols:"6"}},[s("client-data",{attrs:{"show-delegate":"",value:e.model,hover:i,"error-messages":e.errorMessages,"service-id":e.serviceId},on:{setClient:e.setClient,clearClient:function(t){return e.clearClient()},update:e.setPowerOfAttorney}})],1),s("v-col",{attrs:{cols:"6"}},[s("v-row",{staticClass:"py-1"},[s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("v-select",{staticClass:"my-0 pt-1",attrs:{outlined:"",dense:"",disabled:!e.isSelectBeneficiary,items:e.selects.cardTypes,rules:[e.rules.required()],label:e.$t("orders.form.fields.document_type"),"error-messages":e.errorMessages.document_type},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.model.order.document_type,callback:function(t){e.$set(e.model.order,"document_type",t)},expression:"model.order.document_type"}})],1),"new"!==e.model.order.document_type?s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("live-search",{staticClass:"my-0 pt-1",attrs:{"module-name":"orders",outlined:"",label:e.$t("orders.form.fields.parent_carnet")+"*",rules:[e.rules.required("parent_carnet")],clearable:"","search-function":e.search},on:{input:e.setParentCard},model:{value:e.selectedCard,callback:function(t){e.selectedCard=t},expression:"selectedCard"}})],1):e._e(),s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("v-select",{staticClass:"my-0 pt-1",attrs:{dense:"",outlined:"",items:e.selects.release_types,disabled:!e.isSelectBeneficiary,label:e.$t("orders.form.fields.release_mode")},on:{input:e.setReleaseMode},model:{value:e.model.order.release_mode,callback:function(t){e.$set(e.model.order,"release_mode",t)},expression:"model.order.release_mode"}})],1),s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("div",{staticClass:"d-flex"},[s("v-text-field",{directives:[{name:"mask",rawName:"v-mask",value:"###",expression:"'###'"}],staticClass:"pt-1",attrs:{outlined:"",dense:"",disabled:!e.isSelectBeneficiary,rules:[e.rules.required(),e.rules.minNumber(1),e.rules.maxNumber(255)],label:e.$t("orders.form.fields.outputs")+"*"},model:{value:e.model.details.outputs,callback:function(t){e.$set(e.model.details,"outputs",t)},expression:"model.details.outputs"}})],1)]),s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("date-picker",{staticClass:"densed-picker",attrs:{outlined:"",dense:"",disabled:!e.isSelectBeneficiary,label:e.$t("orders.form.fields.document_valid_from")+"*",rules:[e.rules.required()],"error-messages":e.errorMessages.document_valid_from,min:(new Date).toISOString()},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.model.order.document_valid_from,callback:function(t){e.$set(e.model.order,"document_valid_from",t)},expression:"model.order.document_valid_from"}})],1),s("v-col",{staticClass:"py-1 mb-4",attrs:{cols:"12"}},[[s("div",[e._v(" "+e._s(e.$t("orders.form.fields.document_valid_until"))+" ")]),e.model.order.document_valid_from?s("div",{staticClass:"text--accent-1"},[e._v(" "+e._s(e.formattedDate)+" ")]):s("div",{staticClass:"text--accent-1"},[e._v(" "+e._s(e.$t("orders.form.fields.select_date"))+" ")])]],2),s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("v-select",{staticClass:" pt-1",attrs:{dense:"",outlined:"",disabled:!e.isSelectBeneficiary,items:e.selects.managers,rules:[e.rules.required()],label:e.$t("orders.form.fields.employee_id")+"*","error-messages":e.errorMessages.employee_id},model:{value:e.model.details.employee_id,callback:function(t){e.$set(e.model.details,"employee_id",t)},expression:"model.details.employee_id"}})],1),s("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[s("v-switch",{staticClass:"mt-2 mb-0 mx-0",attrs:{dense:"",disabled:!e.isSelectBeneficiary,color:"primary",label:e.$t("orders.form.fields.for_cci_exposition")},model:{value:e.model.order.for_cci_exposition,callback:function(t){e.$set(e.model.order,"for_cci_exposition",t)},expression:"model.order.for_cci_exposition"}})],1)],1)],1)],1),s("v-row",{staticClass:"mx-2"},[e.selects.countries.length?s("v-col",{staticClass:"d-flex justify-space-between cursor-pointer py-0",attrs:{cols:"12",sm:"12",md:"12",lg:"12",xl:"12"},on:{click:function(t){return e.toggleCountries("destination")}}},[s("div",[s("span",{staticClass:"text-h6"},[e._v(" "+e._s(e.$t("orders.form.fields.admited_countries")+"("+e.destinationCountries.length+")")+" ")]),s("v-text-field",{staticClass:"error-input",attrs:{outlined:"",disabled:!e.isSelectBeneficiary,rules:[e.rules.minCount(1)]},model:{value:e.destinationCountries,callback:function(t){e.destinationCountries=t},expression:"destinationCountries"}})],1),s("v-icon",{staticClass:"cursor-pointer toggle-icon mt-1",staticStyle:{width:"30px",height:"30px"}},[e._v(" "+e._s(e.isShowCountries.destination?"mdi-chevron-up":"mdi-chevron-down")+" ")])],1):e._e(),e._l(e.selects.countries,(function(t){return s("v-col",{directives:[{name:"show",rawName:"v-show",value:e.isShowCountries.destination,expression:"isShowCountries.destination"}],key:t.code,staticClass:"py-0",attrs:{cols:"12",sm:"4",md:"4",lg:"3",xl:"2"}},[s("div",{staticClass:"input-checkbox text-2-rows d-flex align-center cursor-pointer ",on:{click:function(s){return e.addCountry(t,"destination")}}},[s("input",{staticClass:"cursor-pointer",class:{"disabled-input":e.isDefaultCountry(t.value)},attrs:{type:"checkbox",disabled:e.isDefaultCountry(t.value)||!e.isSelectBeneficiary},domProps:{checked:e.isCheckedCountry(t,"destination")}}),s("label",{staticClass:"ml-2 cursor-pointer"},[e._v(e._s(t.text))])])])})),s("v-col",{staticClass:"pa-0",attrs:{cols:"12"}},[s("v-divider")],1),e.selects.countries.length?s("v-col",{staticClass:"d-flex cursor-pointer justify-space-between pt-3 pb-4",attrs:{cols:"12",sm:"12",md:"12",lg:"12",xl:"12"},on:{click:function(t){return e.toggleCountries("transit")}}},[s("div",[s("span",{staticClass:"text-h6"},[e._v(" "+e._s(e.$t("orders.form.fields.tranzited_countries")+" ("+e.transitedCountries.length+")")+" ")])]),s("v-icon",{staticClass:"cursor-pointer toggle-icon mt-1",staticStyle:{width:"30px",height:"30px"}},[e._v(" "+e._s(e.isShowCountries.transit?"mdi-chevron-up":"mdi-chevron-down")+" ")])],1):e._e(),e._l(e.selects.countries,(function(t,i){return s("v-col",{directives:[{name:"show",rawName:"v-show",value:e.isShowCountries.transit,expression:"isShowCountries.transit"}],key:i,staticClass:"py-0",attrs:{cols:"12",sm:"4",md:"4",lg:"3",xl:"2"}},[s("div",{staticClass:"input-checkbox text-2-rows d-flex align-center cursor-pointer ",on:{click:function(s){return e.addCountry(t,"transit")}}},[s("input",{staticClass:"cursor-pointer",attrs:{disabled:!e.isSelectBeneficiary,type:"checkbox"},domProps:{checked:e.isCheckedCountry(t,"transit")}}),s("label",{staticClass:"ml-2 cursor-pointer"},[e._v(e._s(t.text))])])])}))],2),s("v-divider",{staticClass:"my-3 "}),s("v-row",{staticClass:"pt-2 py-0  mx-2"},[s("v-col",{attrs:{cols:"12"}},[s("div",{staticClass:"text-h6"},[e._v(" "+e._s(e.$t("orders.form.fields.goods_info"))+" ")])]),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"12",md:"12",lg:"3",xl:"3"}},[s("v-select",{attrs:{outlined:"",dense:"",label:e.$t("orders.form.fields.purpose")+"*",items:e.selects.purpose,disabled:!e.isSelectBeneficiary,"return-object":"",rules:[e.rules.required("purpose_id")],"error-messages":e.errorMessages.purpose_id},on:{change:e.setPurposeDescription},scopedSlots:e._u([{key:"item",fn:function(t){var i=t.item;return[s("div",{staticClass:"d-block full-width mb-1 mt-2"},[s("p",{staticClass:"mb-0",staticStyle:{"line-height":"1"}},[e._v(" "+e._s(i.text)+" ")]),s("span",{staticClass:"grey--text caption"},[e._v(" "+e._s(i.description)+" ")])])]}}],null,!0),model:{value:e.model.details.purpose_id,callback:function(t){e.$set(e.model.details,"purpose_id",t)},expression:"model.details.purpose_id"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"12",md:"12",lg:"9",xl:"9"}},[s("v-text-field",{attrs:{outlined:"",dense:"",label:e.$t("orders.form.fields.purpose_description")+"*",rules:[e.rules.required("purpose_description")],disabled:!e.isSelectBeneficiary,"error-messages":e.errorMessages["order.purpose_description"]},model:{value:e.model.details.purpose_description,callback:function(t){e.$set(e.model.details,"purpose_description",t)},expression:"model.details.purpose_description"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",md:"3"}},[s("v-select",{attrs:{dense:"",outlined:"",clearable:"",label:e.$t("orders.form.fields.packing_category"),items:e.selects.packingCategories,disabled:!e.isSelectBeneficiary,"error-messages":e.errorMessages["order.packing_category_id"]},model:{value:e.model.details.packing_category_id,callback:function(t){e.$set(e.model.details,"packing_category_id",t)},expression:"model.details.packing_category_id"}})],1),s("v-col",{staticClass:"py-0"},[s("v-text-field",{attrs:{dense:"",outlined:"",disabled:!e.isSelectBeneficiary,rules:[e.rules.min(3),e.rules.max(255)],label:e.$t("orders.form.fields.packing_description"),"error-messages":e.errorMessages["order.packing_description"]},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.model.details.packing_description,callback:function(t){e.$set(e.model.details,"packing_description",t)},expression:"model.details.packing_description"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"12",md:"2",lg:"2",xl:"2"}},[s("v-select",{attrs:{dense:"",outlined:"",items:e.selects.units,disabled:!e.isSelectBeneficiary,rules:[e.rules.required()],label:e.$t("orders.form.fields.measure_unit_id")+"*","error-messages":e.errorMessages["order.measure_unit_id"]},model:{value:e.model.details.measure_unit_id,callback:function(t){e.$set(e.model.details,"measure_unit_id",t)},expression:"model.details.measure_unit_id"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"12",md:"2",lg:"2",xl:"2"}},[s("div",{staticClass:"d-flex"},[s("v-select",{staticClass:"mr-2",attrs:{dense:"",outlined:"","return-object":"",disabled:!e.isSelectBeneficiary,items:e.selects.currencies,rules:[e.rules.required()],label:e.$t("orders.form.fields.currency")+"*","error-messages":e.errorMessages["order.currency_id"],measure_unit_id:""},on:{input:e.getExchangeRate},model:{value:e.currency,callback:function(t){e.currency=t},expression:"currency"}}),s("v-text-field",{attrs:{outlined:"",dense:"",disabled:!e.isSelectBeneficiary,type:"number",rules:[e.rules.required()],"error-messages":e.errorMessages["order.exchange_rate"],label:e.$t("orders.form.fields.exchange_rate")+"*"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.model.details.exchange_rate,callback:function(t){e.$set(e.model.details,"exchange_rate",t)},expression:"model.details.exchange_rate"}})],1)])],1),s("v-divider",{staticClass:"my-5"}),s("v-row",{staticClass:"mx-1"},[s("v-col",{staticClass:"pb-0",attrs:{cols:"12"}},[s("div",{staticClass:"text-h6"},[e._v(" "+e._s(e.$t("orders.form.fields.goods"))+" ")]),s("v-text-field",{staticClass:"error-input",attrs:{outlined:"","error-messages":e.errorMessages["details.goods"]},model:{value:e.model.details.goods,callback:function(t){e.$set(e.model.details,"goods",t)},expression:"model.details.goods"}})],1),0===e.model.details.goods.length?s("v-col",{staticClass:"py-0",attrs:{cols:"12"}},[s("div",{staticClass:"text-center full-width"},[e._v(" "+e._s(e.$t("orders.form.fields.minimum_goods"))+" ")])]):e._e()],1),s("products-picker",{attrs:{outlined:"",dense:"",value:e.model,disabled:!e.isSelectBeneficiary,currency:e.currency,"service-id":e.serviceId,"error-messages":e.errorMessages},on:{input:e.changeData}}),s("v-divider",{staticClass:"my-5"}),s("v-row",{staticClass:"mx-2 mb-2"},[s("v-col",{staticClass:"pb-0",attrs:{cols:"12"}},[s("div",{staticClass:"text-h6"},[e._v(" "+e._s(e.$t("orders.form.fields.transport_means"))+" ")])]),s("v-col",{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"6",lg:"6",xl:"6"}},[s("v-select",{staticClass:"pt-1",attrs:{dense:"",outlined:"",items:e.selects.transports,disabled:!e.isSelectBeneficiary,rules:[e.rules.required()],"error-messages":e.errorMessages["order.transport_category_id"],label:e.$t("orders.form.fields.transport_category")+"*"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.model.details.transport_category_id,callback:function(t){e.$set(e.model.details,"transport_category_id",t)},expression:"model.details.transport_category_id"}})],1),s("v-col",{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"6",lg:"6",xl:"6"}},[s("v-text-field",{staticClass:" pt-1",attrs:{outlined:"",dense:"",disabled:!e.isSelectBeneficiary,label:e.$t("orders.form.fields.transport_description")},model:{value:e.model.details.transport_description,callback:function(t){e.$set(e.model.details,"transport_description",t)},expression:"model.details.transport_description"}})],1)],1),s("v-divider"),e.isSelectBeneficiary?s("documents",{attrs:{"error-messages":e.errorMessages,"order-type":e.serviceId,area:"other",value:e.model.documents},on:{update:e.loadDocuments}}):e._e(),s("v-row",{staticClass:"actions mt-5"},[s("v-col",{staticClass:"pa-2 d-flex align-center"},[s("span",{staticClass:"caption"},[e._v(" "+e._s(e.$t("global-validation.is_required"))+" ")]),s("v-spacer"),s("v-btn",{attrs:{link:"",to:"/orders",text:""}},[e._v(" "+e._s(e.$t("global-buttons.close"))+" ")]),s("v-btn",{staticClass:"ml-2",attrs:{color:"primary",depressed:"",disabled:e.isLoading},on:{click:e.submit}},[e.isLoading?s("v-progress-circular",{staticStyle:{position:"absolute"},attrs:{indeterminate:"",color:"primary"}}):e._e(),e._v(" "+e._s(e.$t("global-buttons.confirm"))+" ")],1)],1)],1)],1)],1),i&&!e.isSelectBeneficiary?s("div",{staticClass:"d-flex align-start justify-center full-width fill-height   display-1",staticStyle:{position:"absolute",top:"10%","z-index":"1"}},[s("v-expand-transition",[s("div",{staticClass:"pa-3",staticStyle:{color:"red"}},[e._v(" "+e._s(e.$t("orders.headers.select_beneficiary"))+" ")])])],1):e._e()],1)]}}])})],1),s("v-tab-item",{key:"services",attrs:{eager:""}},[s("v-card",{attrs:{flat:""}},[s("v-card-text",[s("order-services",{attrs:{"service-type-id":e.serviceId,value:e.model},on:{updateVat:e.updateVat,remove:e.removeService,setService:e.setService,input:e.getOrderSum}})],1)],1)],1)],1)],1)],1)],1)},r=[],a=(s("a4d3"),s("e01a"),s("4de4"),s("7db0"),s("c740"),s("13d5"),s("45fc"),s("a434"),s("b0c0"),s("b65f"),s("a9e3"),s("d3b7"),s("3ca3"),s("ddb0"),s("b85c")),n=s("3835"),o=s("5530"),l=(s("96cf"),s("1da1")),c=s("2b0e"),d=s("cb40"),u=s("0613"),m=s("5607a"),v=s("0f8b"),h=s("de5b"),f=s("3a60"),p=s("e894"),_=s("1af5"),g=s("b755"),y=c["a"].extend({name:"AtaCreateOrder",components:{OrderServices:g["a"],ClientData:p["a"],ProductsPicker:v["a"],LiveSearch:m["a"],Documents:_["a"],DatePicker:d["a"]},props:{language:{type:String,default:"ru",required:!0},serviceId:{required:!0,type:Number},allocations:{required:!0,type:Object}},directives:{mask:f["mask"]},data:function(){return{rules:h["a"],loading:!1,isSelectBeneficiary:!1,selectedCard:null,model:{documents:[],details:{goods:[],services:[],countries:[],exchange_rate:"1.0000",outputs:"1"},order:{source:"operator",document_type:"original",client:{type:""},document_valid_from:(new Date).toISOString().substr(0,10),guaranty_required:!1,power_of_attorney:"beneficiary"}},scannedDocuments:[],errorMessages:{},selects:{cardTypes:[],managers:[],countries:[],purpose:[],packingCategories:[],transports:[],currencies:[],units:[],languages:[],client_types:[],release_types:[],services:[]},lang:u["a"].getters["localization/getCurrent"],allDelegates:!1,currency:{},selectedTab:0,totalSum:0,isShowCountries:{destination:!1,transit:!1},isShowDocuments:!0,isShowDocumentsNumber:!1,isLoading:!1,breadcrumb:[{text:"orders.title",disabled:!1,href:"/orders"},{text:"orders.form.header.create",disabled:!0,href:"/orders/edit"}],defaultCountry:null,powerOfAttorney:null,serviceKey:0}},watch:{language:{immediate:!0,handler:function(){this.model.order.language=this.language}},goodsSum:function(){this.goodsSum&&(this.model.details.required_guaranty_sum=Math.max(Math.trunc(.3*this.goodsSum),0))},"model.documents":{immediate:!0,deep:!0,handler:function(){this.$forceUpdate()}}},computed:{isClassic:function(){return"classic"===this.model.order.power_of_attorney},destinationCountries:function(){return this.model.details.countries.filter((function(e){return"destination"==e.scope}))},transitedCountries:function(){return this.model.details.countries.filter((function(e){return"transit"==e.scope}))},formattedDate:function(){return this.$moment(this.model.order.document_valid_from,"YYYY-MM-DD").add(1,"years").subtract(1,"days").format("DD.MM.YYYY")},goodsSum:function(){return this.model.details.goods.reduce((function(e,t){var s=t.quantity,i=t.price;return e+Number(s)*Number(i)}),0)},parentLanguage:function(){return"ro"===this.model.order.language}},mounted:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadData();case 2:case"end":return t.stop()}}),t)})))()},methods:{changePowerType:function(e){this.model.order.power_of_attorney=e},isJuridicalPerson:function(){var e;return"juridical"===(null===(e=this.model.order)||void 0===e?void 0:e.client.type)},isDefaultCountry:function(e){return this.defaultCountry===e},loadData:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,s={"x-localization":e.language},t.next=5,Promise.all([e.$API.transportTypes().getList(s),e.$API.purposeOfUse().getList(e.serviceId,s),e.$API.countries().getAcceptAta(),e.$API.services().getListByServiceType(e.serviceId),e.$API.orders().getOrderReleaseModes(),e.$API.clients().getClientTypes(),e.$API.orders().getCardTypes(e.serviceId),e.$API.measureUnits().getList(e.serviceId),e.$API.packingCategories().getList(s),e.$API.currency().getList(),e.$API.orders().getLanguages(),e.$API.branches().getList(),e.$API.employees().getListByService(e.serviceId)]);case 5:return i=t.sent,t.next=8,e.setServerResponse(i);case 8:t.next=14;break;case 10:return t.prev=10,t.t0=t["catch"](1),t.next=14,u["a"].dispatch("alert/showError",t.t0.message);case 14:e.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[1,10]])})))()},isCheckedCountry:function(e,t){var s;return null===(s=this.model.details.countries)||void 0===s?void 0:s.some((function(s){return s.country_id===e.value&&s.scope===t}))},submit:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var s,i,r,a,n,l,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isLoading=!0,s=e.$refs.form,t.prev=2,!s.validate()){t.next=24;break}if(e.model.documents=e.model.documents.filter((function(e){return"confirm_represent_power"!==e.file_type})),e.powerOfAttorney.file&&e.model.documents.push(e.powerOfAttorney),i=Object(o["a"])({},e.model),i.order.service_type_id=e.serviceId,r=e.allocations,a=r.branch_id,n=r.subdivision_id,l=r.handler_id,i.order.branch_id=a,i.order.subdivision_id=n,i.order.handler_id=l,e.parentLanguage)for(c in i.details.goods)i.details.goods[c].name_ro=i.details.goods[c].name;return i.details.guaranty_required||(i.details.required_guaranty_sum=0),i.order.document_valid_until=e.$moment(e.model.order.document_valid_from,"YYYY-MM-DD").add(1,"years").subtract(1,"days").format("YYYY-MM-DD"),t.next=17,e.$API.orders().create(i);case 17:return s.updateGuard(),t.next=20,e.$router.push("/orders");case 20:return t.next=22,e.$store.dispatch("alert/showSuccess",e.$t("global-alert.successful_create"));case 22:t.next=27;break;case 24:return e.selectedTab=0,t.next=27,setTimeout((function(){var t=s.inputs.find((function(e){return e.messagesToDisplay.length}));t&&e.$vuetify.goTo(t.$el,{offset:150})}),500);case 27:t.next=39;break;case 29:if(t.prev=29,t.t0=t["catch"](2),!t.t0.hasOwnProperty("errors")){t.next=37;break}return e.errorMessages=t.t0.errors,1===t.t0.errors.length?t.t0.errors.hasOwnProperty("order")&&t.t0.errors.order.hasOwnProperty("required_guaranty_sum")&&(e.selectedTab=1):t.t0.errors.length&&(e.selectedTab=0),t.next=36,setTimeout((function(){var t=s.inputs.find((function(e){return e.messagesToDisplay.length}));t&&e.$vuetify.goTo(t.$el,{offset:150})}),500);case 36:setTimeout((function(){e.errorMessages={}}),4e3);case 37:return t.next=39,e.$store.dispatch("alert/showError",t.t0.message||t.t0);case 39:e.isLoading=!1;case 40:case"end":return t.stop()}}),t,null,[[2,29]])})))()},setServerResponse:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function s(){var i,r,a,o,l,c,d,u,m,v,h,f,p,_;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:i=Object(n["a"])(e,13),r=i[0],a=i[1],o=i[2],l=i[3],c=i[4],d=i[5],u=i[6],m=i[7],v=i[8],h=i[9],f=i[10],p=i[11],_=i[12],t.selects.currencies=h.items,t.selects.transports=r.items,t.model.details.transport_category_id=r.default,t.selects.languages=f.items,t.selects.purpose=a,t.selects.countries=o.items,o.default&&(t.defaultCountry=o.default,t.model.details.countries.push({country_id:o.default,scope:"destination"})),t.selects.services=l,t.selects.managers=_.items,t.model.details.employee_id=_.default,t.selects.release_types=c.items,t.model.order.release_mode=c.default,t.selects.client_types=d,t.selects.cardTypes=u.items,t.model.order.document_type=u.default,t.selects.units=m,t.selects.packingCategories=v,t.selects.branches=p,t.$nextTick((function(){t.currency=h.items.find((function(e){return e.value===h.default})),t.getExchangeRate(t.currency)}));case 20:case"end":return s.stop()}}),s)})))()},addCountry:function(e,t){if(this.isSelectBeneficiary)if(this.model.details.countries.some((function(s){return s.country_id===e.value&&s.scope===t}))){var s=this.model.details.countries.findIndex((function(s){return s.country_id===e.value&&s.scope===t}));-1!==s&&this.model.details.countries.splice(s,1)}else this.model.details.countries.push({country_id:e.value,scope:t})},search:function(e,t){var s=this;return Object(l["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,s.$API[t]().liveSearch(e);case 3:return i.abrupt("return",i.sent);case 6:return i.prev=6,i.t0=i["catch"](0),i.next=10,s.$store.dispatch("alert/showError");case 10:case"end":return i.stop()}}),i,null,[[0,6]])})))()},searchClient:function(e,t){var s=this;return Object(l["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,s.$API[t]().liveSearchClient(e);case 3:return i.t0=i.sent,i.abrupt("return",{items:i.t0});case 7:return i.prev=7,i.t1=i["catch"](0),i.next=11,s.$store.dispatch("alert/showError");case 11:case"end":return i.stop()}}),i,null,[[0,7]])})))()},getExchangeRate:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function s(){var i;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(s.prev=0,t.model.details.currency_id=e.value,t.currency=e,"MDL"!==e.text){s.next=6;break}return t.model.details.exchange_rate="1.0000",s.abrupt("return");case 6:return s.next=8,t.$API.exchangeRates().getExchangeRate(e.value);case 8:i=s.sent,i&&(t.model.details.exchange_rate=i.value),s.next=17;break;case 12:return s.prev=12,s.t0=s["catch"](0),t.model.details.exchange_rate=1,s.next=17,t.$store.dispatch("alert/showError",t.$t("orders.form.fields.no_rate"));case 17:case"end":return s.stop()}}),s,null,[[0,12]])})))()},setClient:function(e){this.model.order.client_id=e.id,this.model.order.client=e,this.isSelectBeneficiary=!0},clearClient:function(){this.model.order.client_id=null,delete this.model.order.client,this.isSelectBeneficiary=!1},changeData:function(e){this.model.details.goods=e},setParentCard:function(e){null!==e&&void 0!==e&&e.value&&(this.model.order.parent_document_id=e.value)},getPayments:function(e){this.model.payments=e},toggleCountries:function(e){this.isShowCountries[e]=!this.isShowCountries[e]},setPurposeDescription:function(e){this.model.details.purpose_id=e.value,null!==e&&void 0!==e&&e.hasOwnProperty("description")&&(this.model.details.purpose_description=e.description)},getOrderSum:function(e){this.totalSum=e},updateVat:function(e){this.model.details.services[e].sum_no_vat=Number(this.model.details.services[e].sum_no_vat),this.model.details.services[e].sum_with_vat=this.addVat(Number(this.model.details.services[e].sum_no_vat)),this.model.details.services[e].remained_sum=Number(this.model.details.services[e].sum_with_vat)-Number(this.model.details.services[e].paid_sum)},removeService:function(e){var t=this;if(Array.isArray(e)){var s,i=Object(a["a"])(e);try{var r=function(){var e=s.value,i=t.model.details.services.findIndex((function(t){return t.service_id===e}));-1!==i&&t.model.details.services.splice(i,1)};for(i.s();!(s=i.n()).done;)r()}catch(o){i.e(o)}finally{i.f()}}else{console.log(this.model.details.services,"model.details.services");var n=this.model.details.services.findIndex((function(t){return t.service_id===e}));-1!==n&&this.model.details.services.splice(n,1)}},addVat:function(e){return e+20*e/100},setService:function(e){var t,s;if(null!==(t=this.model.details)&&void 0!==t&&null!==(s=t.services)&&void 0!==s&&s.some((function(t){return t.service_id===e.service_id}))){var i=this.model.details.services.findIndex((function(t){return t.service_id===e.service_id}));this.model.details.services[i]=Object(o["a"])(Object(o["a"])({},this.model.details.services[i]),e)}else this.model.details.services.push(e)},loadDocuments:function(e){this.model.documents=e},setPowerOfAttorney:function(e){this.powerOfAttorney=Object(o["a"])({},e)},setReleaseMode:function(e){this.model.order.release_mode=e,this.model.order=JSON.parse(JSON.stringify(this.model.order)),this.$forceUpdate()}}}),b=y,x=(s("e910"),s("2877")),C=s("6544"),w=s.n(C),S=s("8336"),k=s("b0af"),$=s("99d9"),O=s("62ad"),P=s("ce7e"),V=s("0789"),M=s("4bd4"),q=s("ce87"),D=s("132d"),j=s("490a"),E=s("0fd9"),A=s("b974"),R=s("3129"),B=s("2fa4"),I=s("b73d"),T=s("71a3"),L=s("c671"),N=s("fe57"),F=s("aac8"),U=s("8654"),z=Object(x["a"])(b,i,r,!1,null,"6f1c4590",null);t["default"]=z.exports;w()(z,{VBtn:S["a"],VCard:k["a"],VCardText:$["c"],VCol:O["a"],VDivider:P["a"],VExpandTransition:V["a"],VForm:M["a"],VHover:q["a"],VIcon:D["a"],VProgressCircular:j["a"],VRow:E["a"],VSelect:A["a"],VSkeletonLoader:R["a"],VSpacer:B["a"],VSwitch:I["a"],VTab:T["a"],VTabItem:L["a"],VTabs:N["a"],VTabsItems:F["a"],VTextField:U["a"]})},ce87:function(e,t,s){"use strict";var i=s("16b7"),r=s("f2e7"),a=s("58df"),n=s("d9bd");t["a"]=Object(a["a"])(i["a"],r["a"]).extend({name:"v-hover",props:{disabled:{type:Boolean,default:!1},value:{type:Boolean,default:void 0}},methods:{onMouseEnter:function(){this.runDelay("open")},onMouseLeave:function(){this.runDelay("close")}},render:function(){return this.$scopedSlots.default||void 0!==this.value?(this.$scopedSlots.default&&(e=this.$scopedSlots.default({hover:this.isActive})),Array.isArray(e)&&1===e.length&&(e=e[0]),e&&!Array.isArray(e)&&e.tag?(this.disabled||(e.data=e.data||{},this._g(e.data,{mouseenter:this.onMouseEnter,mouseleave:this.onMouseLeave})),e):(Object(n["c"])("v-hover should only contain a single element",this),e)):(Object(n["c"])("v-hover is missing a default scopedSlot or bound value",this),null);var e}})},dee1:function(e,t,s){"use strict";s("ab20")},e910:function(e,t,s){"use strict";s("f54c")},f54c:function(e,t,s){}}]);
//# sourceMappingURL=chunk-55cf54f5.42ea7660.js.map